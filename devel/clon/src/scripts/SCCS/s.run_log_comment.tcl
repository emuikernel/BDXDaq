h40320
s 00017/00012/01945
d D 1.98 04/11/09 10:14:02 sergpozd 100 99
c Corrected reading of config. and mon. files
e
s 00006/00006/01951
d D 1.97 04/10/22 11:13:47 sergpozd 99 98
c removed " -1 -1 " from "dimanc" inputs
e
s 00004/00004/01953
d D 1.96 04/03/16 16:09:21 gurjyan 98 97
c *** empty log message ***
e
s 00003/00000/01954
d D 1.95 04/01/15 12:23:32 gurjyan 97 96
c in case level1 memory is corrupted save the memory file in the $CLON_PARMS/ts.
e
s 00000/00000/01954
d D 1.94 03/12/16 23:37:42 boiarino 96 95
c .
e
s 00005/00005/01949
d D 1.93 02/10/02 12:11:54 wolin 95 94
c a2ps and new bor2map link in CLON_PARMS
e
s 00002/00002/01952
d D 1.92 02/09/20 09:54:41 gurjyan 94 93
c *** empty log message ***
e
s 00005/00004/01949
d D 1.91 02/09/19 17:16:12 gurjyan 93 92
c *** empty log message ***
e
s 00012/00004/01941
d D 1.90 02/05/15 12:09:08 gurjyan 92 91
c *** empty log message ***
e
s 00001/00001/01944
d D 1.89 02/04/17 15:02:53 wolin 91 90
c download_trig_config options
e
s 00004/00004/01941
d D 1.88 02/02/04 11:00:35 gurjyan 90 89
c typo
c 
e
s 00001/00000/01944
d D 1.87 01/12/10 10:00:18 gurjyan 89 87
c *** empty log message ***
e
s 00001/00000/01944
d D 1.86.1.1 01/12/10 09:58:10 gurjyan 88 87
c set change_link to electron for Moller runs.
c 
e
s 00006/00000/01938
d D 1.86 01/11/09 11:16:55 gurjyan 87 86
c added new parameters for run_type and target_type
c 
e
s 00008/00006/01930
d D 1.85 01/11/07 15:17:48 gurjyan 86 85
c *** empty log message ***
e
s 00065/00001/01871
d D 1.84 01/11/06 17:13:20 gurjyan 85 84
c added l1 memory check
c 
e
s 00004/00004/01868
d D 1.83 01/10/29 08:08:30 gurjyan 84 83
c *** empty log message ***
e
s 00001/00001/01871
d D 1.82 01/10/26 10:12:50 gurjyan 83 82
c *** empty log message ***
e
s 00001/00001/01871
d D 1.81 01/10/26 09:30:56 gurjyan 82 81
c *** empty log message ***
e
s 00001/00001/01871
d D 1.80 01/10/26 09:21:32 gurjyan 81 80
c *** empty log message ***
e
s 00004/00004/01868
d D 1.79 01/10/23 09:10:26 gurjyan 80 79
c *** empty log message ***
e
s 00000/00000/01872
d D 1.78 01/10/15 14:17:26 gurjyan 79 78
c test
c 
e
s 00002/00000/01870
d D 1.77 01/08/27 11:30:30 gurjyan 78 77
c NA for mini_raster
c 
e
s 00016/00010/01854
d D 1.76 01/06/11 15:26:27 gurjyan 77 76
c minor corrections 
c 
e
s 00000/00000/01864
d D 1.75 01/05/04 08:13:23 gurjyan 76 75
c ??
c 
e
s 00000/00000/01864
d D 1.74 01/05/01 14:04:38 gurjyan 75 74
c typo
c 
e
s 00019/00019/01845
d D 1.73 01/05/01 13:54:11 gurjyan 74 73
c changed High/Lo to A/B
c 
e
s 00004/00004/01860
d D 1.72 01/05/01 13:35:03 gurjyan 73 72
c typo
c 
e
s 00002/00000/01862
d D 1.71 01/04/16 08:04:38 gurjyan 72 71
c added N-15 target
c 
e
s 00015/00015/01847
d D 1.70 01/04/02 10:58:18 gurjyan 71 70
c renamed high - A and low - B
c 
e
s 00036/00005/01826
d D 1.69 01/03/26 11:28:23 gurjyan 70 69
c *** empty log message ***
e
s 00001/00001/01830
d D 1.68 01/03/21 15:51:52 gurjyan 69 68
c *** empty log message ***
e
s 00001/00001/01830
d D 1.67 01/03/21 15:47:51 gurjyan 68 67
c *** empty log message ***
e
s 00002/00000/01829
d D 1.66 01/03/21 09:48:10 gurjyan 67 66
c parsing after new download
c 
e
s 00828/00110/01001
d D 1.65 01/03/21 09:47:24 gurjyan 66 65
c *** empty log message ***
e
s 00111/00008/01000
d D 1.64 01/03/06 15:33:56 gurjyan 65 64
c read the thresholds back
c 
e
s 00016/00012/00992
d D 1.63 01/02/16 16:47:34 gurjyan 64 63
c just debuging
c 
e
s 00076/00013/00928
d D 1.62 01/02/16 11:38:36 gurjyan 63 62
c add new button
c 
e
s 00008/00001/00933
d D 1.61 01/02/12 13:11:05 gurjyan 62 61
c *** empty log message ***
e
s 00001/00000/00933
d D 1.60 00/09/28 10:45:19 gurjyan 61 60
c 
e
s 00001/00001/00932
d D 1.59 00/08/24 11:43:54 gurjyan 60 59
c 
e
s 00018/00018/00915
d D 1.58 00/08/14 14:40:49 gurjyan 59 58
c 
e
s 00002/00000/00931
d D 1.57 00/04/04 18:20:01 gurjyan 58 57
c new target type D2+H2
c 
e
s 00131/00029/00800
d D 1.56 00/04/04 18:19:18 gurjyan 57 56
c 
e
s 00004/00000/00825
d D 1.55 99/04/19 10:59:59 gurjyan 56 55
c adding e1 targets
c 
e
s 00031/00031/00794
d D 1.54 98/12/23 16:56:28 gurjyan 55 54
c reformating file output
c 
e
s 00001/00001/00824
d D 1.53 98/12/23 12:18:45 gurjyan 54 53
c *** empty log message ***
e
s 00003/00001/00822
d D 1.52 98/12/23 12:16:36 gurjyan 53 52
c created a current_runsheet.txt file for JAVA
c 
e
s 00004/00004/00819
d D 1.51 98/11/18 17:27:32 clasrun 52 51
c no clasrun
c 
e
s 00006/00000/00817
d D 1.50 98/11/18 17:24:59 clasrun 51 50
c *** empty log message ***
e
s 00001/00001/00816
d D 1.49 98/06/24 09:16:13 gurjyan 50 49
c change "'" to ","
c 
e
s 00000/00000/00817
d D 1.48 98/06/23 18:53:45 gurjyan 49 48
c *** empty log message ***
e
s 00001/00001/00816
d D 1.47 98/06/07 04:25:38 gurjyan 48 47
c new progress file for G6
c 
e
s 00002/00002/00815
d D 1.46 98/05/12 11:51:26 gurjyan 47 46
c vhanged the output format: ignore and comment
c 
e
s 00010/00006/00807
d D 1.45 98/05/12 11:49:16 gurjyan 46 45
c *** empty log message ***
e
s 00147/00146/00666
d D 1.44 98/04/23 22:48:37 gurjyan 45 44
c up/down ;-)
c 
e
s 00031/00012/00781
d D 1.43 98/04/21 09:17:29 gurjyan 44 43
c {'} {''} substitution for the shiftcrue variable.
c 
e
s 00015/00005/00778
d D 1.42 98/04/16 14:57:18 clasrun 43 42
c Typo 
e
s 00046/00052/00737
d D 1.41 98/04/10 22:31:02 gurjyan 42 41
c *** empty log message ***
e
s 00009/00024/00780
d D 1.40 98/04/10 20:52:43 gurjyan 41 40
c castomizing the printup
c 
e
s 00003/00000/00801
d D 1.39 98/04/10 11:21:39 gurjyan 40 39
c pop up the photon runsheet in case previous button & runtype = photon
c 
e
s 00004/00004/00797
d D 1.38 98/04/10 11:13:16 gurjyan 39 38
c *** empty log message ***
e
s 00002/00000/00799
d D 1.37 98/04/10 10:02:37 gurjyan 38 37
c Forget to add global variables to proc print
c 
e
s 00002/00001/00797
d D 1.36 98/04/07 23:13:12 gurjyan 37 36
c added clon_bin env variable 
c 
e
s 00017/00000/00781
d D 1.35 98/04/07 22:02:42 gurjyan 36 35
c warning massage in caser of undefined runtype
c 
e
s 00001/00000/00780
d D 1.34 98/04/07 21:54:02 gurjyan 35 34
c sorry
c 
e
s 00031/00001/00749
d D 1.33 98/04/07 21:46:18 gurjyan 34 33
c added photon run_sheet 
c 
e
s 00001/00001/00749
d D 1.32 98/03/30 16:29:30 wolin 33 32
c Changed beam_photon to photon
c 
e
s 00005/00001/00745
d D 1.31 98/02/25 18:16:55 gurjyan 32 31
c nomore one line buttons ;-)
c 
e
s 00004/00004/00742
d D 1.30 98/02/19 01:04:14 gurjyan 31 30
c catch the lp error
c 
e
s 00001/00001/00745
d D 1.29 98/02/11 11:59:13 gurjyan 30 29
c *** empty log message ***
e
s 00002/00002/00744
d D 1.28 98/02/09 07:57:51 gurjyan 29 28
c *** empty log message ***
e
s 00004/00001/00742
d D 1.27 98/02/08 19:25:41 gurjyan 28 27
c 
e
s 00001/00001/00742
d D 1.26 98/02/07 00:39:24 clasrun 27 26
c *** empty log message ***
e
s 00017/00007/00726
d D 1.25 98/02/04 14:10:25 clasrun 26 25
c env variable dependence
c 
e
s 00000/00000/00733
d D 1.24 98/02/04 14:00:39 clasrun 25 24
c diman to dimanc
c 
e
s 00003/00003/00730
d D 1.23 98/02/04 13:59:59 clasrun 24 23
c test
c 
e
s 00006/00002/00727
d D 1.22 98/01/22 09:50:25 wolin 23 22
c Few typos
c 
e
s 00017/00015/00712
d D 1.21 98/01/22 09:30:33 wolin 22 21
c Added env vars, other minor mods
c 
e
s 00001/00001/00726
d D 1.20 98/01/21 09:56:47 gurjyan 21 20
c 01/21/98 vhg
c 
e
s 00053/00053/00674
d D 1.19 98/01/20 16:23:13 wolin 20 19
c Modified archive file format
c 
e
s 00066/00027/00661
d D 1.18 98/01/20 16:15:00 clasrun 19 18
c I need to work on it in my acct...ejw
e
s 00550/00852/00138
d D 1.17 97/12/12 14:54:39 clasrun 18 17
c Vardans new version, many mods
c 
e
s 00017/00024/00973
d D 1.16 97/12/12 13:43:58 clasrun 17 16
c Not sure if new version is ok, but someone edited it
e
s 00034/00041/00963
d D 1.15 97/06/03 12:38:05 wolin 16 15
c Updated variable names...still no beamrequest
e
s 00015/00016/00989
d D 1.14 97/04/10 18:10:34 clasrun 15 14
c Cosmetic changes
e
s 00029/00016/00976
d D 1.13 97/04/10 17:13:07 wolin 14 13
c Numerous minor improvements, new variables, etc.
e
s 00078/00022/00914
d D 1.12 97/04/10 16:28:24 clasrun 13 12
c Steve added latof check box
e
s 00383/00163/00553
d D 1.11 97/04/08 09:20:30 clasrun 12 11
c many new procedures
e
s 00000/00000/00716
d D 1.10 97/04/07 11:56:44 clasrun 11 10
c Active sector buttons now work. Added procedures to read ascii files
c for both text and entry widgets
e
s 00505/00019/00211
d D 1.9 97/03/25 17:18:25 clasrun 10 9
c Added many new widgets
e
s 00007/00005/00223
d D 1.8 97/03/06 11:15:38 wolin 9 8
c Switched from text to entry widget for logbook book,page
e
s 00012/00008/00216
d D 1.7 97/03/05 13:16:36 wolin 8 7
c Partially bombproofed book and page number
e
s 00017/00012/00207
d D 1.6 97/02/28 15:57:44 clasrun 7 6
c fixed problem with single quotes
e
s 00028/00015/00191
d D 1.5 97/02/13 10:07:27 wolin 6 5
c Eliminated printout, added session name
e
s 00021/00001/00185
d D 1.4 96/12/12 11:59:26 wolin 5 4
c Now uses command line flags, other minor mods
e
s 00012/00016/00174
d D 1.3 96/12/11 16:20:35 wolin 4 3
c Added auto printout of data and template for comment field
e
s 00001/00001/00189
d D 1.2 96/12/11 15:21:21 wolin 3 1
c Now handles 120 lines in comment
e
s 00000/00000/00000
d R 1.2 96/12/11 14:39:29 Codemgr 2 1
c SunPro Code Manager data about conflicts, renames, etc...
c Name history : 2 1 run_log/s/run_log_comment.tcl
c Name history : 1 0 s/run_log_comment.tcl
e
s 00190/00000/00000
d D 1.1 96/12/11 14:39:28 wolin 1 0
c Tk script for run_log_comment.c
e
u
U
f e 0
t
T
I 19
D 22
# by VHG
#
#
E 19
I 1
#!/bin/sh
E 22
I 22
#  run_log_comment.tcl
E 22
D 4
#exec  /clas/cebafb/u1/cmobj/tcltk/hpux.plt/wish4.1 -f "$0" ${1+"$@"}
#if [file executable guiBuilder] {
#  set env(GUI_BUILDER) $env(PWD)
#} else {
#  set env(GUI_BUILDER) [file dirname [exec which guiBuilder]]
#}
#global num_images images
#if {![info exists num_images]} {set num_images 0}
#global Menu_string
#global auto_path images num_images
#if {[file exists $env(GUI_BUILDER)/common.tcl]} {
#  puts "loading $env(GUI_BUILDER)/common.tcl"
#  source  $env(GUI_BUILDER)/common.tcl
#  puts "loading $env(GUI_BUILDER)/extensions.tcl"
#  source  $env(GUI_BUILDER)/extensions.tcl
#}
E 4
I 4
D 7

E 7
I 7
D 18
# 2-28-97 fixed problem with single '
E 7
I 5
#  Still to do:
#     bombproof i/o
#     enable extra editing keys (tab between fields, etc.)
#     reformat screen
E 18

I 22
D 28
# by VHG, ejw, 22-jan-98
E 28
I 28
# by vhg, ejw, 22-jan-98
I 34
# modified 04-07-98 by vhg
I 57
# modified 07-07-99 by vhg
E 57
E 34
E 28

I 34
D 42
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling
E 42
I 42
D 46
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling Tag_cur
E 46
I 46
D 66
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling Tag_cur PS_cur
E 66
I 66
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling Tag_cur PS_cur kuku
E 66
E 46
E 42
E 34

I 35

E 35
E 22
D 8
#   sb, ejw, 12-dec-96
E 8
I 8
D 18
#   sb, ejw, 5-mar-97
E 18
I 18
global archivfile arcomment aropper texto j 
D 57
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale
E 57
I 57
global date runtype change_link runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale
E 57
E 18
E 8

I 18
global .f3.entry2 .f17.text .f15.entry1 .f15.entry2
I 26
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59
E 26
E 18

I 66
global des_l1_conf des_l2_conf des_ts_in1 des_ts_in2 des_ts_in3 des_ts_in4 des_ts_in5 des_ts_in6 des_ts_in7 des_ts_in8 des_ts_in9 des_ts_in10 des_ts_in11 des_ts_in12 des_ts_pres1 des_ts_pres2 des_ts_pres3 des_ts_pres4 des_ts_pres5 des_ts_pres6 des_ts_pres7 des_ts_pres8 des_ec_inner_h des_ec_outer_h des_ec_total_h des_ec_inner_l des_ec_outer_l des_ec_total_l des_sc_pretrig des_cc_pretrig
E 66
I 26

I 42
D 44
set Tag_cur 0
E 44
I 44
#set Tag_cur 0
I 66
set kuku 0
E 66
E 44

E 42
  set clonparms $env(CLON_PARMS)
D 60
 set clonwsrc $env(CLON_WSOURCE)
E 60
I 60
 set clonwsrc $env(CLON_SOURCE)
E 60
I 37
set clonbin $env(CLON_BIN)
E 37

I 45
#======================Proc's =============================#
I 66
#============= Those processes are reading the hardware and comparing with the global configuration file settings ========
#============= This process reads the global configuration file and fills the global variables ===========================
proc parse_global_config {} {
    global clonparms des_l1_conf des_l2_conf des_ts_in1 des_ts_in2 des_ts_in3 des_ts_in4 des_ts_in5 des_ts_in6 des_ts_in7 des_ts_in8 des_ts_in9 des_ts_in10 des_ts_in11 des_ts_in12 des_ts_pres1 des_ts_pres2 des_ts_pres3 des_ts_pres4 des_ts_pres5 des_ts_pres6 des_ts_pres7 des_ts_pres8 des_ec_inner_h des_ec_outer_h des_ec_total_h des_ec_inner_l des_ec_outer_l des_ec_total_l des_sc_pretrig des_cc_pretrig

    set d [open $clonparms/trigger/current_trig_config.cfg r]
    while {[gets $d line] >= 0} {
I 92
#	set PP [lindex $line 0]
#	puts $PP
E 92
	if { [lindex $line 0] == "<l1trig>"} {
	    gets $d line
D 77
	    set des_l1_conf [lindex $line 0] 
E 77
I 77
	    set des_l1_conf [lindex $line 0]
D 81
	    set des_l1_conf "$des_l1_conf "
E 81
I 81
D 93
	    set des_l1_conf "$des_l1_conf"
E 81
E 77
#	    puts "l1 trigger => $des_l1_conf"
E 93
I 93
	    set des_l1_conf "/usr/local/clas/parms/$des_l1_conf"
#	    puts "l1 trigger =&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&> $des_l1_conf"
E 93


I 92
	} elseif {[lindex $line 0] == "<l2trig"} {
	    gets $d line
	    set des_l2_conf "IGNORE" 
#	    puts "l2 trigger => $des_l2_conf"

E 92
	} elseif {[lindex $line 0] == "<l2trig>"} {
	    gets $d line
	    set des_l2_conf [lindex $line 0] 
#	    puts "l2 trigger => $des_l2_conf"
	
D 92

E 92
	} elseif {[lindex $line 0] == "<l1enable>"} {
	    gets $d line
	    gets $d line
	    gets $d line
	    set des_ts_in1 [lindex $line 0]
	    set des_ts_in2 [lindex $line 1]
	    set des_ts_in3 [lindex $line 2]
	    set des_ts_in4 [lindex $line 3]
	    set des_ts_in5 [lindex $line 4]
	    set des_ts_in6 [lindex $line 5]
	    set des_ts_in7 [lindex $line 6]
	    set des_ts_in8 [lindex $line 7]
	    set des_ts_in9 [lindex $line 8]
	    set des_ts_in10 [lindex $line 9]
	    set des_ts_in11 [lindex $line 10]
	    set des_ts_in12 [lindex $line 11]
#	    puts "TS Inputs => $des_ts_in1 $des_ts_in2 $des_ts_in3 $des_ts_in4 $des_ts_in5 $des_ts_in6 $des_ts_in7 $des_ts_in8 $des_ts_in9 $des_ts_in10 $des_ts_in11 $des_ts_in12 "
	

	} elseif {[lindex $line 0] == "<prescale>"} {
	    gets $d line
	    gets $d line
	    gets $d line
	    set des_ts_pres1 [lindex $line 0]
	    set des_ts_pres2 [lindex $line 1]
	    set des_ts_pres3 [lindex $line 2]
	    set des_ts_pres4 [lindex $line 3]
	    set des_ts_pres5 [lindex $line 4]
	    set des_ts_pres6 [lindex $line 5]
	    set des_ts_pres7 [lindex $line 6]
	    set des_ts_pres8 [lindex $line 7]
#	    puts "TS prescales => $des_ts_pres1 $des_ts_pres2 $des_ts_pres3 $des_ts_pres4 $des_ts_pres5 $des_ts_pres6 $des_ts_pres7 $des_ts_pres8 "
	
# ============= ec pretrigger ======================
	} elseif {[lindex $line 0] == "<ecpretrig>"} {
	    gets $d line
	    set temp_cfg [lindex $line 0] 
D 90
#	    puts "ec pretrig config => $temp_cfg"
E 90
I 90
	    # puts "ec pretrig config => $temp_cfg"
E 90
	    #====== open temp cfg file and read the desirable thr values =====
	    set tempf [ open $clonparms/$temp_cfg r]
	    while {[gets $tempf tline] >= 0} {
		set dddd [lindex $tline 0]
		
D 71
			if { [lindex $tline 0] == "#innerhigh"} {
E 71
I 71
D 74
			if { [lindex $tline 0] == "#innerA"} {
E 74
I 74
			if { [lindex $tline 0] == "#innerhigh"} {
E 74
E 71
			    gets $tempf tline
				gets $tempf tline
				set thr1 [lindex $tline 12]
				gets $tempf tline
				set thr2 [lindex $tline 12]
				gets $tempf tline
				set thr3 [lindex $tline 12]
				gets $tempf tline
				set thr4 [lindex $tline 12]
				gets $tempf tline
				set thr5 [lindex $tline 12]
				gets $tempf tline
				set thr6 [lindex $tline 12]
			    set des_ec_inner_h [expr ($thr1+$thr2+$thr3+$thr4+$thr5+$thr6)/6]


D 71
			} elseif { [lindex $tline 0] == "#outerhigh"} {
E 71
I 71
D 74
			} elseif { [lindex $tline 0] == "#outerA"} {
E 74
I 74
			} elseif { [lindex $tline 0] == "#outerhigh"} {
E 74
E 71
			    gets $tempf tline
				gets $tempf tline
				set thr1 [lindex $tline 12]
				gets $tempf tline
				set thr2 [lindex $tline 12]
				gets $tempf tline
				set thr3 [lindex $tline 12]
				gets $tempf tline
				set thr4 [lindex $tline 12]
				gets $tempf tline
				set thr5 [lindex $tline 12]
				gets $tempf tline
				set thr6 [lindex $tline 12]
			    set des_ec_outer_h [expr ($thr1+$thr2+$thr3+$thr4+$thr5+$thr6)/6]
			

D 71
			} elseif { [lindex $tline 0] == "#totalhigh"} {
E 71
I 71
D 74
			} elseif { [lindex $tline 0] == "#totalA"} {
E 74
I 74
			} elseif { [lindex $tline 0] == "#totalhigh"} {
E 74
E 71
			    gets $tempf tline
				gets $tempf tline
				set thr1 [lindex $tline 12]
				gets $tempf tline
				set thr2 [lindex $tline 12]
				gets $tempf tline
				set thr3 [lindex $tline 12]
				gets $tempf tline
				set thr4 [lindex $tline 12]
				gets $tempf tline
				set thr5 [lindex $tline 12]
				gets $tempf tline
				set thr6 [lindex $tline 12]
			    set des_ec_total_h [expr ($thr1+$thr2+$thr3+$thr4+$thr5+$thr6)/6]
			

D 71
			} elseif { [lindex $tline 0] == "#innerlow"} {
E 71
I 71
D 74
			} elseif { [lindex $tline 0] == "#innerB"} {
E 74
I 74
			} elseif { [lindex $tline 0] == "#innerlow"} {
E 74
E 71
			    gets $tempf tline
				gets $tempf tline
				set thr1 [lindex $tline 12]
				gets $tempf tline
				set thr2 [lindex $tline 12]
				gets $tempf tline
				set thr3 [lindex $tline 12]
				gets $tempf tline
				set thr4 [lindex $tline 12]
				gets $tempf tline
				set thr5 [lindex $tline 12]
				gets $tempf tline
				set thr6 [lindex $tline 12]
			    set des_ec_inner_l [expr ($thr1+$thr2+$thr3+$thr4+$thr5+$thr6)/6]
			

D 71
			} elseif { [lindex $tline 0] == "#outerlow"} {
E 71
I 71
D 74
			} elseif { [lindex $tline 0] == "#outerB"} {
E 74
I 74
			} elseif { [lindex $tline 0] == "#outerlow"} {
E 74
E 71
			    gets $tempf tline
				gets $tempf tline
				set thr1 [lindex $tline 12]
				gets $tempf tline
				set thr2 [lindex $tline 12]
				gets $tempf tline
				set thr3 [lindex $tline 12]
				gets $tempf tline
				set thr4 [lindex $tline 12]
				gets $tempf tline
				set thr5 [lindex $tline 12]
				gets $tempf tline
				set thr6 [lindex $tline 12]
			    set des_ec_outer_l [expr ($thr1+$thr2+$thr3+$thr4+$thr5+$thr6)/6]
			

D 71
			} elseif { [lindex $tline 0] == "#totallow"} {
E 71
I 71
D 74
			} elseif { [lindex $tline 0] == "#totalB"} {
E 74
I 74
			} elseif { [lindex $tline 0] == "#totallow"} {
E 74
E 71
			    gets $tempf tline
				gets $tempf tline
				set thr1 [lindex $tline 12]
				gets $tempf tline
				set thr2 [lindex $tline 12]
				gets $tempf tline
				set thr3 [lindex $tline 12]
				gets $tempf tline
				set thr4 [lindex $tline 12]
				gets $tempf tline
				set thr5 [lindex $tline 12]
				gets $tempf tline
				set thr6 [lindex $tline 12]
			    set des_ec_total_l [expr ($thr1+$thr2+$thr3+$thr4+$thr5+$thr6)/6]
			}
	    }
	    close $tempf
	    puts "EC pretrigger => $des_ec_inner_h  $des_ec_outer_h $des_ec_total_h $des_ec_inner_l  $des_ec_outer_l $des_ec_total_l " 
	 
#====== end ec pretrig ========
# ============= sc pretrigger ======================
	} elseif {[lindex $line 0] == "<scpretrig>"} {
	    gets $d line
	    set temp_cfg [lindex $line 0] 
#	    puts "sc pretrig config => $temp_cfg"
	    #====== open temp cfg file and read the desirable thr values =====
	    set tempf [ open $clonparms/$temp_cfg r]
D 100
	    gets $tempf tline
	    gets $tempf tline
	    gets $tempf tline
	    gets $tempf tline
E 100
I 100
#-----------  skip 7 lines  ----------------------------------------------
	    for {set jj 1} {$jj<=8} {incr jj 1}  { gets $tempf tline }
#-------------------------------------------------------------------------
E 100
	    set thr1 [lindex $tline 2]
	    gets $tempf tline
	    set thr2 [lindex $tline 2]
	    gets $tempf tline
	    set thr3 [lindex $tline 2]
	    gets $tempf tline
	    set thr4 [lindex $tline 2]
	    gets $tempf tline
	    set thr5 [lindex $tline 2]
	    gets $tempf tline
	    set thr6 [lindex $tline 2]
	    gets $tempf tline
	    set thr7 [lindex $tline 2]
	    gets $tempf tline
	    set thr8 [lindex $tline 2]
	    gets $tempf tline
	    set thr9 [lindex $tline 2]
	    gets $tempf tline
	    gets $tempf tline
	    set thr10 [lindex $tline 2]
	    gets $tempf tline
	    set thr11 [lindex $tline 2]
	    gets $tempf tline
	    set thr12 [lindex $tline 2]
	    gets $tempf tline
	    set thr13 [lindex $tline 2]
	    gets $tempf tline
	    set thr14 [lindex $tline 2]
	    gets $tempf tline
	    set thr15 [lindex $tline 2]
	    gets $tempf tline
	    set thr16 [lindex $tline 2]
	    gets $tempf tline
	    set thr17 [lindex $tline 2]
	    gets $tempf tline
	    set thr18 [lindex $tline 2]
	    close $tempf
	    set des_sc_pretrig [expr ( $thr1+$thr2+$thr3+$thr4+$thr5+$thr6+$thr7+$thr8+$thr9+$thr10+$thr11+$thr12+$thr13+$thr14+$thr15+$thr16+$thr17+$thr18)/18]
#	    puts "SC pretrigger => $des_sc_pretrig"
	
#====== end sc pretrig ========
# ============= cc pretrigger ======================
	} elseif {[lindex $line 0] == "<ccpretrig>"} {
	    gets $d line
	    set temp_cfg [lindex $line 0] 
#	    puts "cc pretrig config => $temp_cfg"
	    #====== open temp cfg file and read the desirable thr values =====
	    set tempf [ open $clonparms/$temp_cfg r]
	    gets $tempf tline
	    gets $tempf tline
	    gets $tempf tline
	    gets $tempf tline
	    gets $tempf tline
	    set thr1 [lindex $tline 0]
	    set thr2 [lindex $tline 1]
	    set thr3 [lindex $tline 2]
	    set thr4 [lindex $tline 3]
	    close $tempf
	    set des_cc_pretrig [expr ($thr1+$thr2+$thr3+$thr4)/4]
#	    puts "CC pretrigger => $des_cc_pretrig"
	} 
#====== end cc pretrig ========
    }
close $d
}

parse_global_config

proc positionWindow { w yposition } {
    wm geometry $w +300+$yposition
}

E 66
proc writefile { } {
D 66
global archivfile arcomment aropper texto j
E 66
I 66
global archivfile arcomment aropper texto j kuku
E 66
D 46
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale
E 46
I 46
D 57
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale PS_cur
E 57
I 57
global date runtype change_link runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale PS_cur
E 57
E 46
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59

if { $runtype == " "} { set runtype *}
if { $raster == " "} { set raster *}
if { $logbook == " "} { set logbook 0}
if { $page == " "} { set page 0}

puts  "$date $runtype $runnum $beamcurrent $target $raster $tk_b_ener $tk_t_cur $tk_mt_cur $trig_conf $chan_conf $ec_inner_h $ec_outer_h $ec_total_h $sc_h $cc_h $ec_inner_l $ec_outer_l $ec_total_l $sc_l $cc_l $logbook $page " 

set f [open $archivfile w+]
D 57
puts $f " $runtype $beamcurrent $target $raster $logbook $page "
E 57
I 57
puts $f " $runtype $beamcurrent $target $raster $logbook $page $change_link"
E 57

close $f

set ff [open $aropper w+]
puts $ff "$shiftcrue "
I 57
puts  "$shiftcrue "
E 57
close $ff

set ff [open $arcomment w+]
puts $f  $comment 
close $f

printsheet

}


proc readfile  { } {
D 66
global archivfile arcomment aropper texto j
E 66
I 66
global archivfile arcomment aropper texto j kuku
E 66
D 46
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale
E 46
I 46
D 57
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale PS_cur
E 57
I 57
global date runtype change_link runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale PS_cur
E 57
E 46
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59

#puts "SIMON $j"
set f [open $archivfile r]
gets $f line
set runtype [lindex $line 0] 
set beamcurrent [lindex $line 1]
#puts $beamcurrent
$beamcr_scale set [expr $beamcurrent*10.0]
set target [lindex $line 2]
set raster [lindex $line 3]
set logbook [lindex $line 4]
$logbook_scale set $logbook
set page [lindex $line 5]
$page_scale set $page
I 57
set change_link [lindex $line 6]
E 57
close $f


set f [open $aropper r]
gets $f line
set  shiftcrue $line
D 50
regsub -all {'} $shiftcrue {''} shiftcrue
E 50
I 50
regsub -all {'} $shiftcrue {,} shiftcrue
E 50
close $f

}

proc printsheet { } {
D 46
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling runtype Tag_cur
E 46
I 46
D 57
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling runtype Tag_cur PS_cur
E 57
I 57
D 66
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling runtype change_link Tag_cur PS_cur
E 66
I 66
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling runtype change_link Tag_cur PS_cur kuku
E 66
E 57
E 46


D 57
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h  ec_outer_h ec_total_h  cc_h ec_inner_l ec_outer_l ec_total_l sc_h sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale l1_mask prescale comment printfile env
E 57
I 57
global date runtype change_link runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h  ec_outer_h ec_total_h  cc_h ec_inner_l ec_outer_l ec_total_l sc_h sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale l1_mask prescale comment printfile env
E 57
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59

set rootdir $env(CLON_PARMS)
if {[catch {set env(DD_NAME)}]==1} {
    set session "clasprod"
} else {
    set session $env(DD_NAME)
}
set exten [format "%06d" $runnum]
set f [open ${rootdir}/run_log/archive/comment_${session}_${exten}.txt w]

puts $f "#  Generated by run_log_comment on [exec date]" 
puts $f ""
D 55
puts $f "      DATE             - $date "
puts $f "      RUN_TYPE         - $runtype"
puts $f "      RUN_NUMBER       - $runnum" 
puts $f "      BEAM_REQUEST     - $beamcurrent  nA"                          
puts $f "      TARGET           - $target"
puts $f "      MINI_RASTER      - $raster"
puts $f "      BEAM_ENERGY      - $tk_b_ener Mev"
puts $f "      TORUS_CURRENT    - $tk_t_cur A"
puts $f "      MINI_CURRENT     - $tk_mt_cur    "
E 55
I 55
puts $f "      DATE            - $date "
puts $f "      RUNTYPE         - $runtype"
puts $f "      RUNNUMBER       - $runnum" 
puts $f "      BEAMREQUEST     - $beamcurrent  nA"                          
puts $f "      TARGET          - $target"
puts $f "      MINIRASTER      - $raster"
puts $f "      BEAMENERGY      - $tk_b_ener Mev"
puts $f "      TORUSCURRENT    - $tk_t_cur A"
puts $f "      MINICURRENT     - $tk_mt_cur    "
E 55
#set a [split $trig_conf /]
#set b [split $chan_conf /]
#set p [lindex $a 7]
#set c [lindex $b 7]
D 55
puts $f "      TIGRIS           - $trig_conf"
puts $f "      CHANNEL_CONFIG   - unused"
puts $f "      L1_MASK          - $l1_mask"
puts $f "      PRESCALE         - $prescale"
E 55
I 55
puts $f "      TIGRIS          - $trig_conf"
puts $f "      CHANNELCONFIG   - unused"
puts $f "      L1MASK          - $l1_mask"
puts $f "      PRESCALE        - $prescale"
E 55
puts $f ""
D 71
puts $f "      L1 lo thresholds in Mv             L1 high thresholds in Mv   "
D 55
puts $f "      EC_INNER_LO   -   $ec_inner_l           EC_INNER_HI   -   $ec_inner_h  "
puts $f "      EC_OUTER_LO   -   $ec_outer_l           EC_OUTER_HI   -   $ec_outer_h "
puts $f "      EC_TOTAL_LO   -   $ec_total_l           EC_TOTAL_HI   -   $ec_total_h"
puts $f "      SC_LO         -   $sc_l            SC_HI         -   $sc_h  "
puts $f "      CC_LO         -   $cc_l          CC_HI         -   $cc_h "
E 55
I 55
puts $f "      ECINNERLO   -   $ec_inner_l           ECINNERHI   -   $ec_inner_h  "
puts $f "      ECOUTERLO   -   $ec_outer_l           ECOUTERHI   -   $ec_outer_h "
puts $f "      ECTOTALLO   -   $ec_total_l           ECTOTALHI   -   $ec_total_h"
puts $f "      SCLO         -   $sc_l            SCHI         -   $sc_h  "
puts $f "      CCLO         -   $cc_l          CCHI         -   $cc_h "
E 71
I 71
D 74
puts $f "      L1 Bthresholds in Mv             L1 A thresholds in Mv   "
puts $f "      ECINNERB  -   $ec_inner_l           ECINNERA  -   $ec_inner_h  "
puts $f "      ECOUTERB  -   $ec_outer_l           ECOUTERA  -   $ec_outer_h "
puts $f "      ECTOTALB  -   $ec_total_l           ECTOTALA  -   $ec_total_h"
puts $f "      SCB        -   $sc_l            SCA        -   $sc_h  "
puts $f "      CCB        -   $cc_l          CCA        -   $cc_h "
E 74
I 74
puts $f "      L1 lo thresholds in Mv             L1 high thresholds in Mv   "
puts $f "      ECINNERLO   -   $ec_inner_l           ECINNERHI   -   $ec_inner_h  "
puts $f "      ECOUTERLO   -   $ec_outer_l           ECOUTERHI   -   $ec_outer_h "
puts $f "      ECTOTALLO   -   $ec_total_l           ECTOTALHI   -   $ec_total_h"
puts $f "      SCLO         -   $sc_l            SCHI         -   $sc_h  "
puts $f "      CCLO         -   $cc_l          CCHI         -   $cc_h "
E 74
E 71
E 55
puts $f ""
D 57
if { $runtype == "photon" } {
E 57
I 57
if { $runtype == "beam_photon" } {
E 57

puts $f " ======= Photon Run ==========="
puts $f ""
D 55
puts $f "      Photon Trigger        - $photon_trig_conf"
puts $f "      Radiator              - $radiator"
puts $f "      Scaler Gate           - $scaler_config1 $scaler_config2 $scaler_config3 $scaler_config4 "
puts $f "      PS_convertor          - $PS_converter "
puts $f "      PC                    - $PC_converter "
puts $f "      TAC                   - $TAC  "
puts $f "      RadPhi                - $RadPhi "
puts $f "      ET_coincidence        - $et_coincidence"
puts $f "      Collimator1           - $collimator1 "
puts $f "      Collimator2           - $collimator2"
puts $f "      Tagger_prescaling     - $tagger_prescaling"
I 46
puts $f "      Tagger current        - $Tag_cur A"
puts $f "      PS current            - $PS_cur A"
E 55
I 55
puts $f "      PhotonTrigger        - $photon_trig_conf"
puts $f "      Radiator             - $radiator"
puts $f "      ScalerGate           - $scaler_config1 $scaler_config2 $scaler_config3 $scaler_config4 "
puts $f "      PSconvertor          - $PS_converter "
puts $f "      PC                   - $PC_converter "
puts $f "      TAC                  - $TAC  "
puts $f "      RadPhi               - $RadPhi "
puts $f "      ETcoincidence        - $et_coincidence"
puts $f "      Collimator1          - $collimator1 "
puts $f "      Collimator2          - $collimator2"
puts $f "      Tagger_prescaling    - $tagger_prescaling"
puts $f "      Tagger current       - $Tag_cur A"
puts $f "      PScurrent            - $PS_cur A"
E 55
E 46

I 57
puts $f 
if { $chan_conf == "not applicable"} {
puts $f "trigger_config_99_005.dat content:"
D 59
    set d [open /usr/local/clas/parms/photon/trigger_config_99_005.dat r]
E 59
I 59
    set d [open $clonparms/photon/trigger_config_99_005.dat r]
E 59
    while {[gets $d line] >= 0} {
puts $f $line
    }
close $d

puts $f "trigger_delay_99_005.dat content:"
D 59
    set d [open /usr/local/clas/parms/photon/trigger_delay_99_005.dat r]
E 59
I 59
    set d [open $clonparms/photon/trigger_delay_99_005.dat r]
E 59
    while {[gets $d line] >= 0} {
puts $f $line
    }
close $d
} else {
puts $f " Trigger configuration file  - $chan_conf"
}


puts $f

E 57
D 53
#------ appendiong the file ----------
E 53
I 53
#------ appending the file ----------
E 53
D 46
set g [ open /home/clasrun/progress/g1/progress_lol.txt a] 
puts $g "$runnum  $trig_conf   $beamcurrent  $radiator    00     $tk_t_cur   $Tag_cur   $target   \"     \"   $photon_trig_conf  $collimator1  $RadPhi $PC_converter  $TAC "  
E 46
I 46
D 48
set g [ open /home/clasrun/progress/g1/may98_runsheet.txt a] 
E 48
I 48
set g [ open /home/clasrun/progress/g6/jun98_runsheet.txt a] 
E 48
puts $g "$runnum|$trig_conf|$beamcurrent|$radiator|$tk_t_cur|$Tag_cur|$PS_cur|$target|$photon_trig_conf|$collimator1|$collimator2|$RadPhi|$PC_converter|$TAC|$et_coincidence|$PS_converter"  
puts $g "-----|-------------------|---|-|-----------|----------|----------|-------|-------------|---|---|---|---|---|---|--"
puts $g
E 46
close $g


}
puts $f ""
puts $f "      OPERATORS  - $shiftcrue"
puts $f ""
puts $f "      LOG_BOOK  - $logbook "
puts $f ""
puts $f "      LOG_PAGE  - $page"
puts $f ""
D 47
puts $f " IGNORE "
E 47
I 47
puts $f "*IGNORE*"
E 47
puts $f "N"
puts $f ""
D 47
puts $f "      COMMENT "
E 47
I 47
puts $f "*COMMENT*"
E 47
puts $f ""
puts $f $comment

close $f


D 94
catch { exec lp -dclonhp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt } result 
E 94
I 94
D 95
catch { exec a2ps -dclonhp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt } result 
E 95
I 95
catch { exec a2ps -P clonhp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt } result 
E 95
E 94

I 53
D 54
catch { exec cp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt ${rootdir}/run_log/archive/current_runsheet.txt } result 
E 54
I 54
catch { exec cp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt ${rootdir}/run_log/current_runsheet.txt } result 
E 54

E 53
}

E 45
E 26
I 18
proc JJ { a } {
global page page_scale
I 26
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59
E 26
E 18

E 5
E 4
D 18
set align_list ""
wm withdraw .
D 10
global Topgeom Toppos time crew db tar bkn bkp run
E 10
I 10
D 16
global Topgeom Toppos time crew db tar bkn bkp run test
E 16
I 16
global Topgeom Toppos time operators comment target bkn bkp run test
E 16
E 10
catch "destroy .top0"

I 12
#---------------------------------------------
E 12
I 4

I 12
proc In_use {widget} {
$widget invoke
E 18
I 18
set page [ $page_scale get ]
E 18
}

E 12
I 5
D 18
#---------------------------------------------
E 18

I 12
D 18
proc load_old { } {
D 13
set entries 50
E 13
I 13
set entries 57
E 13
D 14
set str5 [open /usr/local/clas/parms/run_log/bits.txt r]
E 14
I 14
set str5 [open /usr/local/clas/parms/run_log/last_bits.txt r]
E 14
for {set i 0} { $i < $entries } {incr i} {
lappend xx [gets $str5]
}
for {set i 0} { $i < $entries } {incr i} {
set check [lindex $xx $i]
if {$check == 1} {
set j [expr $i + 510]
In_use .top0.b$j 
}
}
close $str5
}
E 18
I 18
proc KK { a } {
global logbook logbook_scale
I 26
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59
E 26
E 18

D 18
#---------------------------------------------

E 12
I 10
proc run_type {a} {
I 14
global runtype
E 14
.top0.mt26 delete 1.0 120.0
.top0.mt26 insert end $a
I 14
set runtype $a
E 18
I 18
set logbook [ $logbook_scale get ]
E 18
E 14
}

D 18
#---------------------------------------------
E 18

I 12
D 18
proc entry_in {widget file} {
set str5 [open  $file r]
set xx [read $str5]
close $str5
set xx  [string trim $xx]
$widget insert end $xx
}
E 18
I 18
proc LL { a } {
E 18

E 12
D 18
#---------------------------------------------
E 18
I 18
global beamcurrent beamcr_scale
I 26
D 59
global env clonparms clonwsrc
E 59
I 59
global env clonparms clonwsrc clonbin
E 59
E 26
E 18

I 12
D 18
proc file_in {widget file} {
set str3 [open $file]
D 16
set tar [read $str3]
$widget insert end $tar
E 16
I 16
set target [read $str3]
$widget insert end $target
E 16
close $str3
E 18
I 18
set beamcurrent [ $beamcr_scale get ]
set beamcurrent  [expr $beamcurrent/10.0]
E 18
}

D 26

D 18
#---------------------------------------------
proc invert_col {col start} {
.top0.b$col deselect
D 13
for {set kk 0} {$kk <= 6} {incr kk} {
E 13
I 13
for {set kk 0} {$kk <= 7} {incr kk} {
E 13
set spot [expr $start + 7*$kk]
In_use .top0.b$spot
}
}
E 18
I 18
set monpath /home/clasrun/dimangui/mondat
E 26
I 26
D 59
set monpath ${clonwsrc}/diman/gui/mondat
E 59
I 59
set monpath ${clonparms}/diman/mondat
E 59
E 26
 
D 52
set archivfile "/home/clasrun/runsheet/archiv.txt"
set arcomment "/home/clasrun/runsheet/arcomment.txt"
set aropper "/home/clasrun/runsheet/aropper.txt"
set printfile "/home/clasrun/runsheet/temprint.txt"
E 52
I 52
D 59
set archivfile "/usr/local/clas/parms/runsheet/archiv.txt"
set arcomment "/usr/local/clas/parms/runsheet/arcomment.txt"
set aropper "/usr/local/clas/parms/runsheet/aropper.txt"
set printfile "/usr/local/clas/parms/runsheet/temprint.txt"
E 59
I 59
set archivfile "$clonparms/runsheet/archiv.txt"
set arcomment "$clonparms/runsheet/arcomment.txt"
set aropper "$clonparms/runsheet/aropper.txt"
set printfile "$clonparms/runsheet/temprint.txt"
E 59
E 52
set hin 0
set j 0
set runtype " "
set beamcurrent 0.0
set target " "
set raster " "
set logbook 0
set page 0
set date " "
set comment " "
set texto .f17.text
set beamcr_scale .f3.entry2
set logbook_scale .f15.entry1
set page_scale .f15.entry2
E 18

I 19

E 19
D 18
#---------------------------------------------
proc invert_all {} {
.top0.b510 deselect
D 13
for {set kk 0} {$kk <= 6} {incr kk} {
E 13
I 13
for {set kk 0} {$kk <= 7} {incr kk} {
E 13
for { set ii 512 } { $ii <= 517} {incr ii} {
set spot [expr $ii + 7*$kk]
In_use .top0.b$spot
}
}
}
#---------------------------------------------
proc highlight_row {start} {
.top0.b$start deselect
for { set ii 1 } { $ii <= 6} {incr ii} {
set spot [expr $ii + $start]
In_use .top0.b$spot
}
}
E 18
I 18
D 66
# get the data on date, thresholds, conf files, etc.
E 66
E 18

D 18
#---------------------------------------------
E 12
E 10
E 5
E 4
D 16
proc old_DB { } {
global db_entry
if {!$db_entry} {
D 6
set str1 [open /usr/local/clas/parms/last_db.txt r]
E 6
I 6
set str1 [open /usr/local/clas/parms/run_log/last_db.txt r]
E 16
I 16
proc old_COMMENT { } {
global comment_entry
if {!$comment_entry} {
set str1 [open /usr/local/clas/parms/run_log/last_comment.txt r]
E 16
E 6
set temp [read $str1]
close $str1
I 4
.top0.t21 delete 1.0 120.0
E 4
.top0.t21 mark set here 1.0
.top0.t21 insert here $temp
D 16
set db_entry 1}
E 16
I 16
set comment_entry 1}
E 16
}
E 18
I 18
D 66
set date [exec date]
set newdate $date
E 66
I 62

E 62
I 28
D 29
exec get_prescale_factors
exec get_ts_l1mask
E 29
I 29
D 66
catch { exec get_prescale_factors } result
catch { exec get_ts_l1mask } result
E 29
E 28
E 18

I 28

E 28
I 5
D 18
#---------------------------------------------
E 18
I 18
# level1 mask read
D 26
set f [open /usr/local/clas/parms/ts/current_ts_l1mask.txt r]
E 26
I 26
set f [open ${clonparms}/ts/current_ts_l1mask.txt r]
E 26
for {set i 1} { $i<=8} {incr i 1} { gets $f line }
set l1_mask $line
#puts $l1_mask
close $f
E 18

E 5
D 18
proc finish { } {
D 7
global time crew db tar bkn bkp
set crew [.top0.t19 get 1.0 5.0 ]
D 3
set db [.top0.t21 get  1.0 18.0]
E 3
I 3
set db [.top0.t21 get  1.0 120.0]
E 3
set tar [.top0.t12 get 1.0 3.0 ]
set bkn [.top0.t14 get 1.0 3.0]
set bkp [.top0.t16 get 1.0 3.0]
E 7
I 7
D 14
global time crew db tar bkn bkp crew_in db_in tar_in bkn_in bkp_in
E 14
I 14
D 16
global time crew db tar bkn bkp crew_in db_in tar_in bkn_in bkp_in hvstatus runtype sectors
E 16
I 16
D 17
global time operators comment target bkn bkp operators_in comment_in target_in bkn_in bkp_in hvstatus runtype activesectors
E 17
I 17
global time operators comment target bkn bkp operators_in comment_in target_in bkn_in bkp_in hvstatus runtype activesectors beamrequest
E 17
E 16
E 14
I 12
global b510  b511 b512 b513 b514 b515 b516 b517 b518 b519 b520 
global b521 b522 b523 b524 b525 b526 b527 b528 b529 b530 b531 
global b532 b533 b534 b535 b536 b537 b538 b539 b540 b541 b542 b543 
global b544 b545 b546 b547 b548 b549 b550 b551 b552 b553 b554 
D 13
global b555 b556 b557  b558 b559 
E 13
I 13
global b555 b556 b557  b558 b559 b560 b561 b562 b563 b564 b565 b566
E 18
I 18
# prescale read
D 26
set f [open /usr/local/clas/parms/ts/current_prescale.txt r]
E 26
I 26
set f [open ${clonparms}/ts/current_prescale.txt r]
E 26
gets $f line 
set prescale $line
#puts $prescale
close $f
E 18
I 14

D 18
set runtype [.top0.mt26 get 1.0 2.0]
set hvstatus [.top0.t26 get 1.0 5.0]
E 14
E 13
E 12
D 16
set crew_in [.top0.t19 get 1.0 5.0 ]
set db_in [.top0.t21 get  1.0 120.0]
set tar_in [.top0.t12 get 1.0 3.0 ]
E 16
I 16
set operators_in [.top0.t19 get 1.0 5.0 ]
set comment_in [.top0.t21 get  1.0 120.0]
set target_in [.top0.t12 get 1.0 3.0 ]
E 16
D 9
set bkn_in [.top0.t14 get 1.0 3.0]
set bkp_in [.top0.t16 get 1.0 3.0]
E 9
I 9
set bkn_in [.top0.t14 get]
set bkp_in [.top0.t16 get]
I 17
set beamrequest [.top0.t28 get 1.0 5.0]
E 17
I 14
set str3 [open /usr/local/clas/parms/run_log/last_runtype.txt w]
set str4 [open /usr/local/clas/parms/run_log/last_hvstatus.txt w]
E 14
E 9
E 7
D 6
set str5 [open /usr/local/clas/parms/last_target.txt w]
set str6 [open /usr/local/clas/parms/last_crew.txt w]
set str7 [open /usr/local/clas/parms/last_db.txt w]
set str8 [open /usr/local/clas/parms/last_booknumber.txt w]
set str9 [open /usr/local/clas/parms/last_bookpage.txt w]
E 6
I 6
set str5 [open /usr/local/clas/parms/run_log/last_target.txt w]
D 16
set str6 [open /usr/local/clas/parms/run_log/last_crew.txt w]
set str7 [open /usr/local/clas/parms/run_log/last_db.txt w]
E 16
I 16
set str6 [open /usr/local/clas/parms/run_log/last_operators.txt w]
set str7 [open /usr/local/clas/parms/run_log/last_comment.txt w]
E 16
set str8 [open /usr/local/clas/parms/run_log/last_booknumber.txt w]
set str9 [open /usr/local/clas/parms/run_log/last_bookpage.txt w]
I 12
D 14
set str10 [open /usr/local/clas/parms/run_log/bits.txt w]
E 14
I 14
set str10 [open /usr/local/clas/parms/run_log/last_bits.txt w]
I 17
set str11 [open /usr/local/clas/parms/run_log/last_current_request.txt w]
E 17
E 14
E 12
E 6
D 7
puts $str5 $tar
puts $str6 $crew
puts $str7 $db
puts $str8 $bkn
puts $str9 $bkp
E 7
I 7
D 16
regsub -all ' $crew_in '' crew
D 8
regsub -all ' $db_in '' db
regsub -all ' $tar_in '' tar
regsub -all ' $bkn_in '' bkn
regsub -all ' $bkp_in '' bkp 
E 8
I 8
regsub -all ' $db_in ''   db
regsub -all ' $tar_in ''  tar
E 16
I 16
regsub -all ' $operators_in '' operators
regsub -all ' $comment_in ''   comment
regsub -all ' $target_in ''  target
E 16
regsub -all ' $bkn_in ''  bkn
D 9
regsub -all ' $bkp_in ''  bkp 
E 9
I 9
regsub -all ' $bkp_in ''  bkp
I 14
set runtype  [string trim $runtype]
set hvstatus  [string trim $hvstatus]
I 17
set beamrequest [string trim $beamrequest]
E 17
E 14
E 9
D 16
set tar  [string trim $tar]
set crew [string trim $crew]
set db   [string trim $db]
E 16
I 16
set target  [string trim $target]
set operators [string trim $operators]
set comment   [string trim $comment]
E 16
set bkp  [string trim $bkp]
set bkn  [string trim $bkn]
set bkp_in $bkp
set bkn_in $bkn
I 14
puts $str3 $runtype
puts $str4 $hvstatus
E 14
E 8
D 16
puts $str5 $tar_in
puts $str6 $crew_in
puts $str7 $db_in
E 16
I 16
puts $str5 $target_in
puts $str6 $operators_in
puts $str7 $comment_in
E 16
puts $str8 $bkn_in
puts $str9 $bkp_in
I 17
puts $str11 $beamrequest
E 17
I 14
close $str3
close $str4
E 14
E 7
close $str5
close $str6
close $str7
close $str8
close $str9
I 17
close $str11
E 17
I 12
puts $str10 $b510
puts $str10 0
puts $str10 $b512
puts $str10 $b513
puts $str10 $b514
puts $str10 $b515
puts $str10 $b516
puts $str10 $b517
puts $str10 0
puts $str10 $b519
puts $str10 $b520
puts $str10 $b521
puts $str10 $b522
puts $str10 $b523
puts $str10 $b524
puts $str10 0
puts $str10 $b526
puts $str10 $b527
puts $str10 $b528
puts $str10 $b529
puts $str10 $b530
puts $str10 $b531
puts $str10 0
puts $str10 $b533
puts $str10 $b534
puts $str10 $b535
puts $str10 $b536
puts $str10 $b537
puts $str10 $b538
puts $str10 0
puts $str10 $b540
puts $str10 $b541
puts $str10 $b542
puts $str10 $b543
puts $str10 $b544
puts $str10 $b545
puts $str10 0
puts $str10 $b547
puts $str10 $b548
puts $str10 $b549
puts $str10 $b550
puts $str10 $b551
puts $str10 $b552
puts $str10 0
puts $str10 $b554
puts $str10 $b555
puts $str10 $b556
puts $str10 $b557
puts $str10 $b558
puts $str10 $b559
I 13
puts $str10 0
puts $str10 $b561
puts $str10 $b562
puts $str10 $b563
puts $str10 $b564
puts $str10 $b565
puts $str10 $b566
E 13
close $str10
D 15
lappend lout $b510
lappend lout 0
E 15
I 15
#lappend lout $b510
#lappend lout 0
E 15
lappend lout $b512
lappend lout $b513
lappend lout $b514
lappend lout $b515
lappend lout $b516
lappend lout $b517
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b519
lappend lout $b520
lappend lout $b521
lappend lout $b522
lappend lout $b523
lappend lout $b524
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b526
lappend lout $b527
lappend lout $b528
lappend lout $b529
lappend lout $b530
lappend lout $b531
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b533
lappend lout $b534
lappend lout $b535
lappend lout $b536
lappend lout $b537
lappend lout $b538
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b540
lappend lout $b541
lappend lout $b542
lappend lout $b543
lappend lout $b544
lappend lout $b545
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b547
lappend lout $b548
lappend lout $b549
lappend lout $b550
lappend lout $b551
lappend lout $b552
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b554
lappend lout $b555
lappend lout $b556
lappend lout $b557
lappend lout $b558
lappend lout $b559
I 13
D 15
lappend lout 0
E 15
I 15
#lappend lout 0
E 15
lappend lout $b561
lappend lout $b562
lappend lout $b563
lappend lout $b564
lappend lout $b565
lappend lout $b566
E 18

E 13
D 14
puts $lout
E 14
I 14
D 16
set sectors $lout
E 16
I 16
D 18
set activesectors $lout
E 16
#puts $lout
E 14
#puts here
E 12
I 5
D 8
set tar  [string trim $tar]
set crew [string trim $crew]
set db   [string trim $db]
E 8
E 5
destroy . 
Resume}
E 18
I 18
# trigger conf read
D 26
set f [open /usr/local/clas/parms/trigger/current_trig_config.txt r]
E 26
I 26
D 44
set f [open ${clonparms}/trigger/current_trig_config.txt r]
E 44
I 44

set f [open ${clonparms}/ts/Current.Config r]
E 44
E 26
gets $f line 
D 44
set trig_conf $line
E 44
I 44
#update
set tfile $line
set atr [split $tfile /]
for { set i 1} { $i < 11} { incr i } {
set atr_f [lindex $atr $i]
#puts $atr_f
 set atr_c [split $atr_f .]
  set atr_cc [lindex $atr_c 1]
   if { $atr_cc == "trg" } { 
set trig_conf $atr_f
break
}
}

#set f [open ${clonparms}/trigger/current_trig_config.txt r]
#gets $f line 
#set trig_conf $line
E 44
#puts $trig_conf
close $f
E 18
I 4

I 18
# channel conf read
D 26
#set f [open /usr/local/clas/parms/channel/current_trig_config.txt r]
E 26
I 26
D 64
#set f [open ${clonparms}/channel/current_trig_config.txt r]
E 26
#gets $f line 
I 44
#set chan_conf --------
E 64
I 64
set f [open ${clonparms}/trigger/current_trig_config.txt r]
gets $f line 
set chan_conf $line
close $f
E 64
E 44
D 26
set chan_conf /usr/local/clas/parms/channel/config/discr1.cfg
E 26
I 26
D 27
set chan_conf ${clonparms}/usr/local/clas/parms/channel/config/discr1.cfg
E 27
I 27
D 57
set chan_conf ${clonparms}/channel/config/discr1.cfg
E 57
I 57
D 62
set coda_config [exec get_coda_config]
E 62
I 62
set coda_config 888
catch { exec get_coda_config } result 
set f [open ${clonparms}/runsheet/current_coda_config.txt r]
gets $f line 
set coda_config $line
close $f

E 66
E 62
D 64
if {$coda_config == "G6_PROD" || $coda_config == "G6_NORM"} {
set chan_conf ${clonparms}/photon/config/g6_trig_prod.pl
} else { set chan_conf "not applicable" }
E 64
I 64
#if {$coda_config == "G6_PROD" || $coda_config == "G6_NORM"} {
#set chan_conf ${clonparms}/photon/config/g6_trig_prod.pl
#} else { set chan_conf "not applicable" }
E 64
E 57
E 27
E 26
#close $f
E 18

I 63
#=================> for gui test
E 63
I 43
D 73
#set run 0
#set b_ener 0
#set t_cur 0
#set mt_cur 0
E 73
I 73
D 74
set run 0
set b_ener 0
set t_cur 0
set mt_cur 0
E 74
I 74
D 80
#set run 0
#set b_ener 0
#set t_cur 0
#set mt_cur 0
E 80
I 80
D 84
set run 0
set b_ener 0
set t_cur 0
set mt_cur 0
E 84
I 84
#set run 0
#set b_ener 0
#set t_cur 0
#set mt_cur 0
E 84
E 80
E 74
E 73
I 63
#=================
E 63

E 43
E 4
D 5
#-- TOP LEVEL -----------------------------------------
E 5
I 5
D 18
#---------------------------------------------
E 18
I 18
set runnum $run
set tk_b_ener $b_ener
set tk_t_cur $t_cur
set tk_mt_cur $mt_cur
E 18

I 18
set newrun $run
set new_b_ener $b_ener
set new_t_cur $t_cur
D 21
set new_mt_cur $mt_cur
E 21
I 21
D 22
et new_mt_cur $mt_cur
E 22
I 22
set new_mt_cur $mt_cur
E 22
E 21
E 18

I 43

E 43
D 18
#-- TOP LEVEL --------------------
E 5
D 17
toplevel .top0 
E 17
I 17
toplevel  .top0 -bg grey
E 17
wm title .top0 {Operator Database Entry}
wm geometry .top0 715x819
wm minsize .top0 1 1
set Toppos(.top0) 0
set Topgeom(.top0) 1
set Name .top0
set Parent $Name
D 16
set db_entry 0
E 16
I 16
set comment_entry 0
E 18
I 18
D 66
proc positionWindow w {
    wm geometry $w +300+300
}
E 18
E 16
I 6

E 66
I 66
 
E 66
I 18
wm title . "Run_Sheet"
D 66
positionWindow .
E 66
I 66
positionWindow . 300 
E 66
E 18

D 15

E 15
E 6
D 18
set Name $Parent.b13
#------------------------------------------
label $Name -bg black -fg yellow -text {Target}
D 10
place $Name -x 24 -relx 0 -y 239 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 10
I 10
place $Name -x 24 -relx 0 -y 160 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
frame .buttons -bg DeepSkyBlue4
pack  .buttons -side bottom -expand y -fill x -pady 2m 
button .buttons.previous -width 4 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text "<<" -relief raised  -bd 7 -command {
readfile 
I 40
D 57
if { $runtype =="photon"} {
E 57
I 57
if { $runtype =="beam_photon"} {
E 57
source ${clonbin}/photon.tcl
E 40
}
I 40
}
E 40
button .buttons.ptext -width 7 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text "Prevcom" -relief raised  -bd 7 -command {
set comment " "
set f [open $arcomment r]
set comment [read $f]
$texto delete 1.0 end
$texto mark set here 1.0
$texto insert here $comment
close $f
#$texto insert end $comment
#puts $comment
}
button .buttons.psheet -width 7 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text "Print" -relief raised  -bd 7 -command {
printsheet
}
E 18
E 10

I 18
D 63
button .buttons.new -width 7 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text New -relief raised  -bd 7 -command {
set runtype " "
$beamcr_scale set  0.0
set raster " "
set target " "
set logbook 0
$logbook_scale set 0
set page 0
$page_scale set 0
set comment " "
$texto delete 1.0 end
#$texto insert end $comment
set shiftcrue " "
E 63
I 63
button .buttons.new -width 7 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text "NewConf" -relief raised  -bd 7 -command {
I 66

    catch {destroy .dlg} result
    catch {destroy .dlg3} result
    catch {destroy .dlg4} result
    catch {destroy .dlg5} result
    catch {destroy .dlg6} result
    catch {destroy .dlg7} result
    catch {destroy .dlg8} result
    catch {destroy .dlg9} result
    catch {destroy .dlg10} result
    catch {destroy .dlg12} result
    catch {destroy .dlg13} result
    catch {destroy .dlg14} result
    catch {destroy .dlg17} result
D 85

E 85
I 85
    catch {destroy .dlg18} result
    catch {destroy .dlg19} result
E 85
E 66
D 64
#===> call elliots gui
catch { exec select_trigger } result

E 64
I 64
#===> call Elliott's gui
I 65
D 91
    catch {puts [exec /bin/csh -c {(unsetenv TCL_LIBRARY;  unsetenv TIX_LIBARY;$CLON_BIN/select_trigger)}]} result
E 91
I 91
    catch {puts [exec /bin/csh -c {(unsetenv TCL_LIBRARY;  unsetenv TIX_LIBARY;$CLON_BIN/select_trigger -mode newconf)}]} result
E 91
E 65
D 66
#    catch { exec /bin/csh -Vc "( unsetenv TCL*; unsetenv TIX*; select_trigger)" } result
#    catch { exec "( unsetenv TCL*; unsetenv TIX*; select_trigger)" } result
#puts $result
E 66
E 64
#===================================================== New readout
# get the data on date, thresholds, conf files, etc.
I 67
parse_global_config

E 67
D 66

E 66
I 66
set kuku 0
E 66
set date [exec date]
set newdate $date

catch { exec get_prescale_factors } result
catch { exec get_ts_l1mask } result


# level1 mask read
set f [open ${clonparms}/ts/current_ts_l1mask.txt r]
for {set i 1} { $i<=8} {incr i 1} { gets $f line }
set l1_mask $line
#puts $l1_mask
close $f
I 66
set ts_in1 [lindex $line 0]
set ts_in2 [lindex $line 1]
set ts_in3 [lindex $line 2]
set ts_in4 [lindex $line 3]
set ts_in5 [lindex $line 4]
set ts_in6 [lindex $line 5]
set ts_in7 [lindex $line 6]
set ts_in8 [lindex $line 7]
set ts_in9 [lindex $line 8]
set ts_in10 [lindex $line 9]
set ts_in11 [lindex $line 10]
set ts_in12 [lindex $line 11]
puts "$ts_in1 $ts_in2 $ts_in3 $ts_in4 $ts_in5 $ts_in6 $ts_in7 $ts_in8 $ts_in9 $ts_in10 $ts_in11 $ts_in12"
puts "$des_ts_in1 $des_ts_in2 $des_ts_in3 $des_ts_in4 $des_ts_in5 $des_ts_in6 $des_ts_in7 $des_ts_in8 $des_ts_in9 $des_ts_in10 $des_ts_in11 $des_ts_in12"
E 66

I 66
#=============== Monitor level1 mask =====================================
if { $ts_in1 != $des_ts_in1 || $ts_in2 != $des_ts_in2 || $ts_in3 != $des_ts_in3 || $ts_in4 != $des_ts_in4 || $ts_in5 != $des_ts_in5 || $ts_in6 != $des_ts_in6 || $ts_in7 != $des_ts_in7 || $ts_in8 != $des_ts_in8 || $ts_in9 != $des_ts_in9 || $ts_in10 != $des_ts_in10 || $ts_in11 != $des_ts_in11 || $ts_in12 != $des_ts_in12 } {
toplevel .dlg -class Dialog
wm title .dlg "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg $kuku
frame .dlg.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg.top -side top -fill both
frame .dlg.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg.bot -side bottom -fill both

message .dlg.top.msg -width 370 -text "Monitored L1 mask does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg
}
button .dlg.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg
}
#pack .dlg.bot.bt1 -side left -expand 1   
#pack .dlg.bot.bt2 -side left -expand 1   
}
#========================================================================

E 66
# prescale read
set f [open ${clonparms}/ts/current_prescale.txt r]
gets $f line 
set prescale $line
D 77
#puts $prescale
E 77
I 77
puts $prescale
E 77
close $f
I 66
set ts_pres1 [lindex $line 0]
set ts_pres2 [lindex $line 1]
set ts_pres3 [lindex $line 2]
set ts_pres4 [lindex $line 3]
set ts_pres5 [lindex $line 4]
set ts_pres6 [lindex $line 5]
set ts_pres7 [lindex $line 6]
set ts_pres8 [lindex $line 7]
E 66
D 77

E 77
I 77
puts "$ts_pres3 $des_ts_pres3"
E 77
I 66
#=============== Monitor Prescale factors ===============================
if { $ts_pres1 != $des_ts_pres1 || $ts_pres2 != $des_ts_pres2 || $ts_pres3 != $des_ts_pres3 || $ts_pres4 != $des_ts_pres4 || $ts_pres5 != $des_ts_pres5 || $ts_pres6 != $des_ts_pres6 || $ts_pres7 != $des_ts_pres7 || $ts_pres8 != $des_ts_pres8 } {
toplevel .dlg1 -class Dialog
wm title .dlg1 "Alarm"
E 66

I 66
set kuku [expr $kuku+100]
positionWindow .dlg1 $kuku

frame .dlg1.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg1.top -side top -fill both
frame .dlg1.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg1.bot -side bottom -fill both

message .dlg1.top.msg -width 370 -text "Monitored prescale factors does not agree with the run_configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg1.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg1.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    catch { exec cp ${clonparms}/ts/current_prescale.txt ${clonparms}/ts/previous_prescale.txt} result
    destroy .dlg1
}
button .dlg1.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg1
}
#pack .dlg1.bot.bt1 -side left -expand 1   
#pack .dlg1.bot.bt2 -side left -expand 1   
}
#========================================================================


E 66
# trigger conf read

set f [open ${clonparms}/ts/Current.Config r]
gets $f line 
D 66
#update
E 66
I 66

E 66
set tfile $line
set atr [split $tfile /]
for { set i 1} { $i < 11} { incr i } {
set atr_f [lindex $atr $i]
#puts $atr_f
 set atr_c [split $atr_f .]
  set atr_cc [lindex $atr_c 1]
D 77
   if { $atr_cc == "trg" } { 
E 77
I 77
   if { $atr_cc == "trg " } { 
E 77
set trig_conf $atr_f
I 77
#set trig_conf "koko"
E 77
break
E 63
}
I 63
}
I 66
D 77
puts " $trig_conf ++> $des_l1_conf"
E 77
I 77
puts "$tfile|++|$des_l1_conf|++|"
E 77
#=============== Monitor Level1 trigger file ===============================
D 68
if { $trig_conf != $des_l1_conf} {
E 68
I 68
if { $tfile != $des_l1_conf} {
E 68
toplevel .dlg9 -class Dialog
wm title .dlg9 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg9 $kuku
E 66

I 66
frame .dlg9.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg9.top -side top -fill both
frame .dlg9.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg9.bot -side bottom -fill both

message .dlg9.top.msg -width 370 -text "Level1 tigger configuration does not agree with the run configuration file!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg9.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg9.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg9
}
button .dlg9.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg9
}
#pack .dlg9.bot.bt1 -side left -expand 1   
#pack .dlg9.bot.bt2 -side left -expand 1   
}
#========================================================================
#=============== Monitor Level2 trigger file ===============================
set f [open ${clonparms}/euphrates/euphrates_current.txt r]
gets $f line 
close $f
set l2_conf $line

D 92
puts "$l2_conf ++> $des_l2_conf"
E 92

D 92
if { $l2_conf != $des_l2_conf} { 
E 92
I 92
if {$des_l2_conf != "IGNORE"} { 
D 98
puts "$des_l2_conf ++> $des_l2_conf"
if {$l2_conf != $des_l2_conf } { 
E 98
I 98
puts " aaaaa $l2_conf ++> ${clonparms}/$des_l2_conf"
if {$l2_conf != ${clonparms}/$des_l2_conf } { 
E 98
E 92
toplevel .dlg10 -class Dialog
wm title .dlg10 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg10 $kuku

frame .dlg10.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg10.top -side top -fill both
frame .dlg10.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg10.bot -side bottom -fill both

message .dlg10.top.msg -width 370 -text "Level2 trigger file does not agree with the run configuration file!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg10.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg10.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg10
}
button .dlg10.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg10
}
#pack .dlg10.bot.bt1 -side left -expand 1   
#pack .dlg10.bot.bt2 -side left -expand 1   
}
I 92
}
E 92
#========================================================================

E 66
#set f [open ${clonparms}/trigger/current_trig_config.txt r]
#gets $f line 
#set trig_conf $line
#puts $trig_conf
D 66
close $f
E 66
I 66
#close $f
E 66

# channel conf read
D 64
#set f [open ${clonparms}/channel/current_trig_config.txt r]
#gets $f line 
#set chan_conf --------
E 64
I 64
set f [open ${clonparms}/trigger/current_trig_config.txt r]
D 70
gets $f line 
set chan_conf $line
E 70
I 70
gets $f line
update
set Ttfile $line
set Tatr [split $Ttfile /]
for { set i 1} { $i < 11} { incr i } {
set Tatr_f [lindex $Tatr $i]
#puts $Tatr_f
 set Tatr_c [split $Tatr_f .]
  set Tatr_cc [lindex $Tatr_c 2]
#puts $Tatr_cc
   if { $Tatr_cc == "cfg" } { 
set Ttfile $Tatr_f
#puts $Ttfile
break
}
}
set chan_conf $Ttfile
E 70
close $f

E 64
set coda_config 888
catch { exec get_coda_config } result 
set f [open ${clonparms}/runsheet/current_coda_config.txt r]
gets $f line 
set coda_config $line
close $f
I 66

E 66
set runnum $run
set tk_b_ener $b_ener
set tk_t_cur $t_cur
set tk_mt_cur $mt_cur

set newrun $run
set new_b_ener $b_ener
set new_t_cur $t_cur
set new_mt_cur $mt_cur
I 65

I 85
#---------- Read level1 memory ---------------------------------------------------------
set result 0
set result [ exec l1_memory_check clastrig2 ]
puts $result

if { $result != 0 } {
I 97

catch { exec cp ${clonparms}/ts/level1_tmp.dat.txt ${clonparms}/ts/level1_${runnum}.dat} result

E 97
toplevel .dlg18 -class Dialog
wm title .dlg18 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg18 $kuku

frame .dlg18.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg18.top -side top -fill both
frame .dlg18.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg18.bot -side bottom -fill both

message .dlg18.top.msg -width 370 -text "Level1 memory is corrupted!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg18.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg18.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg18
}
button .dlg18.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg18
}
}
#---------- Read level1 memory ---------------------------------------------------------






E 85
#-------------------------------reading ec level1---------------------------------------
D 66
catch { exec1 dimanc mon p ec -1 -1 } result
E 66
I 66
D 99
catch { exec dimanc mon p ec -1 -1 } result
E 99
I 99
catch { exec dimanc mon p ec } result
E 99

E 66
set f [open $monpath/mon_ec_p.txt r]

D 100
for { set i 1} { $i<=6} {incr i 1}  { gets $f line } 
E 100
I 100
#---  skip 6 lines  ----------------------------------------------
for { set i 1} { $i<=7} {incr i 1}  { gets $f line } 
E 100
set ecpin_sec1 [lindex $line 0]
set ecpin_sec2 [lindex $line 1]
set ecpin_sec3 [lindex $line 2]
set ecpin_sec4 [lindex $line 3]
set ecpin_sec5 [lindex $line 4]
set ecpin_sec6 [lindex $line 5]
set ec_inner_h [expr ($ecpin_sec1+$ecpin_sec2+$ecpin_sec3+$ecpin_sec4+$ecpin_sec5+$ecpin_sec6)/6]
gets $f line
set ecpout_sec1 [lindex $line 0]
set ecpout_sec2 [lindex $line 1]
set ecpout_sec3 [lindex $line 2]
set ecpout_sec4 [lindex $line 3]
set ecpout_sec5 [lindex $line 4]
set ecpout_sec6 [lindex $line 5]
set ec_outer_h [expr ($ecpout_sec1+$ecpout_sec2+$ecpout_sec3+$ecpout_sec4+$ecpout_sec5+$ecpout_sec6)/6]
gets $f line
set ecptot_sec1 [lindex $line 0]
set ecptot_sec2 [lindex $line 1]
set ecptot_sec3 [lindex $line 2]
set ecptot_sec4 [lindex $line 3]
set ecptot_sec5 [lindex $line 4]
set ecptot_sec6 [lindex $line 5]
set ec_total_h [expr ($ecptot_sec1+$ecptot_sec2+$ecptot_sec3+$ecptot_sec4+$ecptot_sec5+$ecptot_sec6)/6]
gets $f line
set ecpinlo_sec1 [lindex $line 0]
set ecpinlo_sec2 [lindex $line 1]
set ecpinlo_sec3 [lindex $line 2]
set ecpinlo_sec4 [lindex $line 3]
set ecpinlo_sec5 [lindex $line 4]
set ecpinlo_sec6 [lindex $line 5]
set ec_inner_l [expr ($ecpinlo_sec1+$ecpinlo_sec2+$ecpinlo_sec3+$ecpinlo_sec4+$ecpinlo_sec5+$ecpinlo_sec6)/6]
gets $f line
set ecpoutlo_sec1 [lindex $line 0]
set ecpoutlo_sec2 [lindex $line 1]
set ecpoutlo_sec3 [lindex $line 2]
set ecpoutlo_sec4 [lindex $line 3]
set ecpoutlo_sec5 [lindex $line 4]
set ecpoutlo_sec6 [lindex $line 5]
set ec_outer_l [expr ($ecpoutlo_sec1+$ecpoutlo_sec2+$ecpoutlo_sec3+$ecpoutlo_sec4+$ecpoutlo_sec5+$ecpoutlo_sec6)/6]
gets $f line
set ecptotlo_sec1 [lindex $line 0]
set ecptotlo_sec2 [lindex $line 1]
set ecptotlo_sec3 [lindex $line 2]
set ecptotlo_sec4 [lindex $line 3]
set ecptotlo_sec5 [lindex $line 4]
set ecptotlo_sec6 [lindex $line 5]
set ec_total_l [expr ($ecptotlo_sec1+$ecptotlo_sec2+$ecptotlo_sec3+$ecptotlo_sec4+$ecptotlo_sec5+$ecptotlo_sec6)/6]
close $f
I 66
#=============== Monitor ec level1 thresholds ===============================
set ab1 [ expr abs( $ec_inner_l - $des_ec_inner_l)]
set ab2 [ expr abs( $ec_outer_l - $des_ec_outer_l)]
set ab3 [ expr abs( $ec_total_l - $des_ec_total_l)]
set ab4 [ expr abs( $ec_inner_h - $des_ec_inner_h)]
set ab5 [ expr abs( $ec_outer_h - $des_ec_outer_h)]
set ab6 [ expr abs( $ec_total_h - $des_ec_total_h)]
 
puts "ec pretrig ++> $ab1 $ab2 $ab3 $ab4 $ab5 $ab6 "

D 86
if { $ab1 > 5 || $ab2 > 5 || $ab3 > 5 || $ab4 > 5 || $ab5 > 5 || $ab6 > 5 } {
E 86
I 86
if { $ab1 > 7 || $ab2 > 7 || $ab3 > 7 || $ab4 > 7 || $ab5 > 7 || $ab6 > 7 } {
E 86
toplevel .dlg3 -class Dialog
wm title .dlg3 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg3 $kuku

frame .dlg3.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg3.top -side top -fill both
frame .dlg3.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg3.bot -side bottom -fill both

message .dlg3.top.msg -width 370 -text "Monitored EC thresholds does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg3.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg3.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg3
}
button .dlg3.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg3
}
#pack .dlg3.bot.bt1 -side left -expand 1   
#pack .dlg3.bot.bt2 -side left -expand 1   
}
#========================================================================

E 66
#--------------------------------------------------------------------------------------
#-----------------------------reading cc level1----------------------------------------
D 99
catch { exec dimanc mon p cc -1 -1 } result
E 99
I 99
catch { exec dimanc mon p cc } result
E 99
set f [open $monpath/mon_cc_p.txt r]

D 100
for { set i 1} { $i<=4} {incr i 1}  { gets $f line } 
E 100
I 100
#---  skip 5 lines  ----------------------------------------------
for { set i 1} { $i<=6} {incr i 1}  { gets $f line } 
E 100
set cctivhigh1 [lindex $line 0]
set cctivlo1 [lindex $line 1]
set cctivhigh2 [lindex $line 2]
set cctivlo2 [lindex $line 3]
set thr1 $cctivhigh1
set thr2 $cctivlo1
set thr11 $cctivhigh2
set thr22 $cctivlo2
set cc_h [ expr ($cctivhigh1+$cctivhigh2)/2]
set cc_l [ expr ($cctivlo1+$cctivlo2)/2]
close $f
I 66
set cc_pretrig [ expr ( $cc_h + $cc_l)/2]
set ab1 [ expr abs( $cc_pretrig - $des_cc_pretrig)]
puts "cc pretrig ++> $ab1"
#=============== Monitor cc level1 thresholds ===============================
D 86
if { $ab1>5 } {
E 86
I 86
if { $ab1>7 } {
E 86
toplevel .dlg4 -class Dialog
wm title .dlg4 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg4 $kuku

frame .dlg4.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg4.top -side top -fill both
frame .dlg4.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg4.bot -side bottom -fill both

message .dlg4.top.msg -width 370 -text "Monitored CC thresholds does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg4.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg4.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg4
}
button .dlg4.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg4
}
#pack .dlg4.bot.bt1 -side left -expand 1   
#pack .dlg4.bot.bt2 -side left -expand 1   
}
#========================================================================
E 66
#---------------------------------------------------------------------------------------
#-----------------------------reading sc level1-----------------------------------------
D 99
catch { exec dimanc mon p sc -1 -1 } result
E 99
I 99
catch { exec dimanc mon p sc } result
E 99
set f [open $monpath/mon_sc_p.txt r]

D 100
for { set i 1} { $i<=3} {incr i 1}  { gets $f line } 
E 100
I 100
#---  skip 5 lines  ----------------------------------------------
for { set i 1} { $i<=5} {incr i 1}  { gets $f line } 
E 100
set i 0
set scthmean 0
set scwidmean 0 
D 100
    while {[gets $f line ] >= 0 } {
E 100
I 100
    while { ([gets $f line ] >= 0) && ([string length $line] > 0) } {
E 100
incr i
set scthr_pg($i) [lindex $line 0]
set scthmean [expr $scthmean+$scthr_pg($i)]
}
set sc_h [expr $scthmean/$i]
set sc_l -
close $f
I 66
set ab1 [ expr abs( $sc_h - $des_sc_pretrig)]
puts "sc pretrig ++> $ab1"
#=============== Monitor sc level1 thresholds ===============================
D 86
if { $ab1>5 } {
E 86
I 86
if { $ab1>7 } {
E 86
toplevel .dlg5 -class Dialog
wm title .dlg5 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg5 $kuku

frame .dlg5.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg5.top -side top -fill both
frame .dlg5.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg5.bot -side bottom -fill both

message .dlg5.top.msg -width 370 -text "Monitored SC thresholds does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg5.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg5.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg5
}
button .dlg5.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg5
}
#pack .dlg5.bot.bt1 -side left -expand 1   
#pack .dlg5.bot.bt2 -side left -expand 1   
}
#========================================================================

E 66
#---------------------------------------------------------------------------------------
set new_ec_inner_h $ec_inner_h
set new_ec_outer_h $ec_outer_h
set new_ec_total_h $ec_total_h
set new_sc_h $sc_h
set new_cc_h $cc_h
set new_ec_inner_l $ec_inner_l
set new_ec_outer_l $ec_outer_l
set new_ec_total_l $ec_total_l
set new_sc_l $sc_l
set new_cc_l $cc_l

E 65
#=============== END of New readout

}
E 63
button .buttons.cancel -width 7 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Abort -relief raised  -bd 7 -command {
D 30
set abort -1
E 30
I 30
set abort -2
E 30
destroy . 
}
button .buttons.done -width 7 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
I 57
D 65
    if { $change_link == "electron" } {
D 59
    catch { exec rm /usr/local/clas/bin/bor2map } result
    catch { exec ln -s /usr/local/clas/bin/bor2map_electron /usr/local/clas/bin/bor2map } result
E 59
I 59
    catch { exec rm $clonbin/bor2map } result
    catch { exec ln -s $clonbin/bor2map_electron $clonbin/bor2map } result
E 59
    } else if { $change_link == "photon" } {
D 59
    catch { exec rm /usr/local/clas/bin/bor2map } result
    catch { exec ln -s /usr/local/clas/bin/bor2map_photon /usr/local/clas/bin/bor2map } result
E 59
I 59
    catch { exec rm $clonbin/bor2map } result
    catch { exec ln -s $clonbin/bor2map_photon $clonbin/bor2map } result
E 59
}
E 65
D 66


E 66
I 66
    catch { exec cp ${clonparms}/ts/current_ts_l1mask.txt ${clonparms}/ts/previous_ts_l1mask.txt} result
    catch { exec cp ${clonparms}/ts/current_prescale.txt ${clonparms}/ts/previous_prescale.txt} result
    catch { exec cp ${clonparms}/runsheet/current_coda_config.txt ${clonparms}/runsheet/previous_coda_config.txt} result
    catch { exec cp $monpath/mon_ec_p.txt ${clonparms}/runsheet/previous_ec_p.txt} result
    catch { exec cp $monpath/mon_cc_p.txt ${clonparms}/runsheet/previous_cc_p.txt} result
    catch { exec cp $monpath/mon_sc_p.txt ${clonparms}/runsheet/previous_sc_p.txt} result
    catch { exec cp  ${clonparms}/ts/Current.Config ${clonparms}/runsheet/current_l1_config.txt} result
    catch { exec cp  ${clonparms}/euphrates/current.trg ${clonparms}/runsheet/current_l2_config.txt} result
E 66
E 57
  if { $target == " " } { 
D 66
toplevel .dlg -class Dialog
wm title .dlg "Alarm"
positionWindow .dlg
frame .dlg.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg.top -side top -fill both
frame .dlg.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg.bot -side bottom -fill both
E 66
I 66
toplevel .dlg6 -class Dialog
wm title .dlg6 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg6 $kuku
E 66
E 18

I 10
D 18
set Name $Parent.b23
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Wheel position}
E 14
I 14
label $Name -bg black -fg yellow -text {HV status}
E 14
place $Name -x 24 -relx 0 -y 210 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
D 66
message .dlg.top.msg -width 3i -text "Target is not specified!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m
E 66
I 66
frame .dlg6.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg6.top -side top -fill both
frame .dlg6.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg6.bot -side bottom -fill both
E 66
E 18

I 18
D 66
button .dlg.bot.bt -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Return -relief raised  -bd 7 -command {
destroy .dlg
E 66
I 66
message .dlg6.top.msg -width 370 -text "Target is not specified!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg6.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg6.bot.bt -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Return -relief raised  -bd 7 -command {
destroy .dlg6
E 66
#focus $oldFocus
}
D 66
pack .dlg.bot.bt -side left -expand 1   
E 66
I 66
#pack .dlg6.bot.bt -side left -expand 1   
I 86


E 86
E 66
I 36
} elseif { $runtype == " " } { 
D 66
toplevel .dlg -class Dialog
wm title .dlg "Alarm"
positionWindow .dlg
frame .dlg.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg.top -side top -fill both
frame .dlg.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg.bot -side bottom -fill both
E 66
I 66
toplevel .dlg7 -class Dialog
wm title .dlg7 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg7 $kuku
E 66

D 66
message .dlg.top.msg -width 3i -text "Runtype is not specified!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m
E 66
I 66
frame .dlg7.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg7.top -side top -fill both
frame .dlg7.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg7.bot -side bottom -fill both
E 66

D 66
button .dlg.bot.bt -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Return -relief raised  -bd 7 -command {
destroy .dlg
E 66
I 66
message .dlg7.top.msg -width 370 -text "Runtype is not specified!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg7.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg7.bot.bt -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Return -relief raised  -bd 7 -command {
destroy .dlg7
E 66
#focus $oldFocus
}
D 66
pack .dlg.bot.bt -side left -expand 1   
E 66
I 66
#pack .dlg7.bot.bt -side left -expand 1   
E 66
E 36
} else {
I 65
 
   if { $change_link == "electron" } {
D 95
    catch { exec rm $clonbin/bor2map } result
    catch { exec ln -s $clonbin/bor2map_electron $clonbin/bor2map } result
E 95
I 95
    catch { exec rm $clonparms/run_log/bor2map } result
    catch { exec ln -s $clonbin/bor2map_electron $clonparms/run_log/bor2map } result
E 95
D 66
    } else if { $change_link == "photon" } {
E 66
I 66
    } elseif { $change_link == "photon" } {
E 66
D 95
    catch { exec rm $clonbin/bor2map } result
    catch { exec ln -s $clonbin/bor2map_photon $clonbin/bor2map } result
E 95
I 95
    catch { exec rm $clonparms/run_log/bor2map } result
    catch { exec ln -s $clonbin/bor2map_photon $clonparms/run_log/bor2map } result
E 95
}

E 65
set comment [string trimright [.f17.text get 1.0 120.0]]
regsub -all {'} $comment {''} comment
I 61
regsub -all {'} $shiftcrue {''} shiftcrue
E 61
writefile
destroy .
}
}
E 18

D 18
set Name $Parent.b25
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Torus current setting}
E 14
I 14
D 16
label $Name -bg black -fg yellow -text {Beam current setpoint}
E 16
I 16
label $Name -bg black -fg yellow -text {Beam current request}
E 16
E 14
place $Name -x 24 -relx 0 -y 250 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
pack .buttons.previous -side left -expand 1
#pack .buttons.enter -side left -expand 1
#pack .buttons.next -side left -expand 1
pack .buttons.ptext -side left -expand 1
pack .buttons.new -side left -expand 1
pack .buttons.psheet -side left -expand 1
pack .buttons.done -side left -expand 1
pack .buttons.cancel -side left -expand 1
E 18


D 18
set Name $Parent.b27
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Torus current reading}
E 14
I 14
label $Name -bg black -fg yellow -text {spare1}
E 14
place $Name -x 24 -relx 0 -y 290 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    frame .f13 -bd 2 -bg DeepSkyBlue4
    label .f13.entry1 -width 31 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -relief sunken  -bd 3 -textvariable date
    label .f13.label1 -relief raised  -bd 4 -fg black -bg azure3 -width 13 -text "Date" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f13.label2 -fg yellow -bg DeepSkyBlue4 -width 12 -text "* CLAS *" -font -Adobe-Times-Bold-R-Normal-*-180-* 
    label .f13.label3 -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 2 -text " " 
    pack .f13.label1 -side left -padx 0m
    pack .f13.entry1 -side left -padx 1m 
    pack .f13.label3 -side left -padx 4m
    pack .f13.label2 -side left -padx 0m
E 18

I 18
set m .f1.label1.rtype
D 57
set mb .f1.label1.rtype.beam
set mc .f1.label1.rtype.calib
E 57
I 57
set me .f1.label1.rtype.electron
set mp .f1.label1.rtype.photon
set mec .f1.label1.rtype.electron.calib
set mpc .f1.label1.rtype.photon.calib
E 57
set hvh .f1.label2.hv
set hvt .f1.label2.hv.trip
E 18

I 57

E 57
D 18
set Name $Parent.b29
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Beam energy}
E 14
I 14
label $Name -bg black -fg yellow -text {spare2}
E 14
place $Name -x 24 -relx 0 -y 330 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    frame .f1 -bd 2 -bg DeepSkyBlue4
    label .f1.entry1  -relief sunken  -bd 3 -width 28  -fg black -bg azure3 -textvariable runtype -font -Adobe-Times-Bold-R-Normal-*-140-*
    menubutton .f1.label1 -relief raised  -bd 4 -fg black -bg yellow2 -font -Adobe-Times-Bold-R-Normal-*-140-* -width 12 -text "Run Type" -menu $m
    label .f1.entry2 -width 7 -fg black -bg azure3 -relief sunken -font -Adobe-Times-Bold-R-Normal-*-140-* -bd 3 -textvariable runnum
    label .f1.label2 -relief raised  -bd 4 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -width 12 -text "Run Number " 
E 18

I 18
    label .f1.label3 -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 3 -text " " 
E 18

D 18
set Name $Parent.b32
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Beam current}
E 14
I 14
label $Name -bg black -fg yellow -text {spare3}
E 14
place $Name -x 24 -relx 0 -y 370 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    pack .f1.label1 -side left -padx 0m
    pack .f1.entry1 -side left -padx 1m
    pack .f1.label3 -side left -padx 2m
    pack .f1.label2 -side left -padx 1m
    pack .f1.entry2 -side left -padx 0m 
E 18


D 18
set Name $Parent.b34
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Mini torus current}
E 14
I 14
label $Name -bg black -fg yellow -text {spare4}
E 14
place $Name -x 24 -relx 0 -y 410 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
menu $m  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
D 57
$m add cascade -label "Beam" -menu $mb 
E 57
I 57

$m add cascade -label "Electron" -menu $me 
E 57
$m add separator
D 57
$m add cascade -label "Calib" -menu $mc
$m add separator
$m add command -label "Cosmic" -command { set runtype cosmic}
E 57
I 57
$m add cascade -label "Photon" -menu $mp
I 87
$m add separator
$m add command -label "Moller" -command {
set runtype moller
I 88
set change_link electron 
E 88
I 89
set change_link electron 
E 89
}
E 87
E 57
E 18

D 18
set Name $Parent.b36
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Level 1 trigger(s)}
E 14
I 14
D 17
label $Name -bg black -fg yellow -text {Level 1 trigger file}
E 17
I 17
label $Name -bg black -fg yellow -text {spare5}
E 17
E 14
place $Name -x 24 -relx 0 -y 450 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
D 57
menu $mb  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
D 33
$mb add command -label "Photon" -command { set runtype beam_photon}
E 33
I 33
D 34
$mb add command -label "Photon" -command { set runtype photon}
E 34
I 34
$mb add command -label "Photon" -command { 
set runtype photon
E 57
I 57
# --------- Electron case ----------
menu $me  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
$me add command -label "Beam" -command {
set change_link electron 
set runtype beam_electron 
}

$me add separator
$me add command -label "Cosmic" -command {
set change_link electron  
set runtype e_cosmic 
}

$me add separator
$me add cascade -label "Calib" -menu $mec

menu $mec  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
$mec add command -label "ADC-Pedestal" -command {
set change_link electron 
set runtype e_calib_ADC-pedestal 
}

$mec add separator
$mec add command -label "TDC-1872" -command {
set change_link electron 
set runtype e_calib_TDC-1872 
} 

$mec add separator
$mec add command -label "TOF-laser" -command {
set change_link electron 
set runtype e_calib_TOF-laser 
}

$mec add separator
$mec add command -label "Misc" -command {
set change_link electron 
set runtype e_calib_misc 
} 

#--------------- Photon case ------------------
menu $mp  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
$mp add command -label "Beam" -command {
set change_link photon  
set runtype beam_photon
E 57
D 37
source photon.tcl
E 37
I 37
source ${clonbin}/photon.tcl
I 57
 }

$mp add separator
$mp add command -label "Cosmic" -command { 
set change_link photon  
set runtype p_cosmic 
E 57
E 37
}
E 34
E 33
D 57
$mb add separator
$mb add command -label "Electron" -command {set runtype beam_electron }
E 57
E 18

D 18
set Name $Parent.b38
#------------------------------------------
D 17
label $Name -bg black -fg yellow -text {prescale factor(s)}
E 17
I 17
label $Name -bg black -fg yellow -text {spare6}
E 17
place $Name -x 24 -relx 0 -y 490 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
D 57
menu $mc  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
$mc add command -label "ADC-Pedestal" -command {set runtype calib_ADC-pedestal }
$mc add separator
$mc add command -label "TDC-1872" -command {set runtype calib_TDC-1872 } 
$mc add separator
$mc add command -label "TOF-laser" -command {set runtype calib_TOF-laser }
$mc add separator
$mc add command -label "Misc" -command {set runtype calib_misc } 
E 57
I 57
$mp add separator
$mp add cascade -label "Calib" -menu $mpc
E 57
E 18

I 57
menu $mpc  -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
$mpc add command -label "ADC-Pedestal" -command {
set change_link photon  
set runtype p_calib_ADC-pedestal 
}
E 57
D 18
set Name $Parent.b40
#------------------------------------------
D 14
label $Name -bg black -fg yellow -text {Target vacuum}
E 14
I 14
D 17
label $Name -bg black -fg yellow -text {spare5}
E 17
I 17
label $Name -bg black -fg yellow -text {spare7}
E 17
E 14
place $Name -x 24 -relx 0 -y 530 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18

I 57
$mpc add separator
$mpc add command -label "TDC-1872" -command {
set change_link photon  
set runtype p_calib_TDC-1872 
} 

$mpc add separator
$mpc add command -label "TOF-laser" -command {
set change_link photon  
set runtype p_calib_TOF-laser 
}

$mpc add separator
$mpc add command -label "Misc" -command {
set change_link photon  
set runtype p_calib_misc 
} 

E 57
I 18
########################## BEAM ENERGY #######################
E 18

E 10
D 6

E 6
D 18
set Name $Parent.b9
#------------------------------------------
D 10
label $Name -bg black -fg yellow -text {Database entry}
place $Name -x 24 -relx 0 -y 325 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 10
I 10
label $Name -bg black -fg yellow -text {Comments}
D 13
place $Name -x 24 -relx 0 -y 590 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 13
I 13
place $Name -x 24 -relx 0 -y 610 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    frame .f2 -bd 2 -bg DeepSkyBlue4
E 18
E 13
E 10

I 18
    label .f2.label -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 2 -text "  " 
    label .f2.chap1 -width 5  -bd 4 -fg black -bg azure3 -relief raised  -text "MeV" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f2.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 15 -text "Beam energy" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f2.number1 -width 11 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable tk_b_ener -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18

D 18
set Name $Parent.b11
#------------------------------------------
label $Name -bg black -fg yellow -text {Log Book}
D 10
place $Name -x 220 -relx 0 -y 319 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 10
I 10
place $Name -x 460 -relx 0 -y 109 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    label .f2.chap2 -width 5  -bd 4 -fg black -bg azure3 -relief raised  -text "A" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f2.label2 -relief raised  -bd 4  -fg black -bg azure3 -width 11 -text "I_Torus" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f2.number2 -width 11 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable tk_t_cur -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
E 10


D 18
set Name $Parent.b19
#------------------------------------------
label $Name -bg black -fg yellow -text {Log Book Page #}
D 10
place $Name -x 450 -relx 0 -y 319 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 10
I 10
place $Name -x 410 -relx 0 -y 160 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    pack .f2.label1 -side left -padx 0m
    pack .f2.number1 -side left -padx 1m
    pack .f2.chap1 -side left -padx 0m
E 18
E 10

I 18
    pack .f2.label -side left -padx 2m
E 18
I 6

I 10
D 18
set Name $Parent.b31
#------------------------------------------
D 17
label $Name -bg black -fg yellow -text {DC Book Page #}
E 17
I 17
label $Name -bg black -fg yellow -text {spare8}
E 17
place $Name -x 410 -relx 0 -y 200 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    pack .f2.label2 -side left -padx 0m
    pack .f2.number2 -side left -padx 1m
    pack .f2.chap2 -side left -padx 0m
E 18

I 18
########################################################################
E 18

D 18
set Name $Parent.b33
#------------------------------------------
D 17
label $Name -bg black -fg yellow -text {EC Book Page #}
E 17
I 17
label $Name -bg black -fg yellow -text {spare9}
E 17
place $Name -x 410 -relx 0 -y 240 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
########################## Next line #######################
E 18

I 18
    frame .f21 -bd 2 -bg DeepSkyBlue4
E 18

D 18
set Name $Parent.b35
#------------------------------------------
D 17
label $Name -bg black -fg yellow -text {TOF Book Page #}
E 17
I 17
label $Name -bg black -fg yellow -text {spare10}
E 17
place $Name -x 410 -relx 0 -y 280 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    label .f21.label -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 2 -text "  " 
    label .f21.chap1 -width 5  -bd 4 -fg black -bg azure3 -relief raised  -text "A" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f21.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 15 -text "I_Minitorus" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f21.number1 -width 11 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable tk_mt_cur -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18


D 18
set Name $Parent.b37
#------------------------------------------
D 17
label $Name -bg black -fg yellow -text {CC Book Page #}
E 17
I 17
label $Name -bg black -fg yellow -text {spare11}
E 17
place $Name -x 410 -relx 0 -y 320 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    pack .f21.label1 -side left -padx 0m
    pack .f21.number1 -side left -padx 1m
    pack .f21.chap1 -side left -padx 0m
E 18

D 18
set Name $Parent.b39
#------------------------------------------
D 17
label $Name -bg black -fg yellow -text {TAG Book Page #}
E 17
I 17
label $Name -bg black -fg yellow -text {spare12}
E 17
place $Name -x 410 -relx 0 -y 360 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18

I 18
########################## Next line #######################
E 18

E 10
E 6
D 18
set Name $Parent.b17
#------------------------------------------
label $Name -bg black -fg yellow -text {Shift Crew}
D 10
place $Name -x 24 -relx 0 -y 72 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 10
I 10
place $Name -x 24 -relx 0 -y 52 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 18
I 18
    frame .f26 -bd 2 -bg DeepSkyBlue4
E 18
E 10

I 18
D 44
    label .f26.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Trigger config file" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 44
I 44
    label .f26.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Tigris config file" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 44
    label .f26.number1 -width 47 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable trig_conf -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
I 6

E 6
D 18
set Name $Parent.mg21
#------------------------------------------
D 10
label $Name -bg purple -fg white -text "Run Number: $run"
E 10
I 10
label $Name -bg orange2  -text "Run Number: $run"
E 10
place $Name -x 444 -relx 0 -y 12 -rely 0 -width {} -relwidth {} -height {} -relheight {} -anchor nw
E 18

I 18
    pack .f26.label1 -side left -padx 0m
    pack .f26.number1 -side left -padx 1m
E 18
I 6

E 6
D 18
set Name $Parent.mg23
#------------------------------------------
D 14
#set mess "Run Category: Calib.\nType:D.C. TOF       " 
D 10
label $Name -bg orange2 -text "Run Type: $mess "
place $Name -x 445 -relx 0 -y 44 -rely 0 -width {} -relwidth {} -height {} -relheight {} -anchor nw
E 10
I 10
label $Name -bg orange2 -text "Configuration: $mess "
E 14
I 14
label $Name -bg orange2 -text "Configuration: $config "
E 14
place $Name -x 444 -relx 0 -y 44 -rely 0 -width {} -relwidth {} -height {} -relheight {} -anchor nw
E 18
I 18
########################################################################
########################## Next line #######################
E 18
E 10

I 10
D 18
set Name $Parent.mb25
#------------------------------------------
menubutton $Name -text "Run Type:"  -bg grey -activebackground green -relief raised -bd 2  -menu $Name.steve
place $Name  -x 444 -relx 0 -y 72 -rely 0 -width {} -relwidth {} -height {} -relheight {} -anchor nw
menu $Name.steve -tearoff false
D 12
$Name.steve add cascade -label "Beam"  -background grey -menu $Name.steve.beam
$Name.steve add cascade -label "Calib"  -background grey -menu $Name.steve.calib
$Name.steve add radiobutton -label "Cosmic" -background grey -selectcolor green -variable test -command {run_type cosmic}
E 12
I 12
$Name.steve add cascade -label "Beam"  -background grey -activebackground green -menu $Name.steve.beam
$Name.steve add cascade -label "Calib"  -background grey -activebackground green -menu $Name.steve.calib
$Name.steve add radiobutton -label "Cosmic" -background grey -activebackground green -selectcolor green -variable test -command {run_type cosmic}
E 12
menu $Name.steve.beam -tearoff false
D 12
$Name.steve.beam add radiobutton -label "Photon"  -background grey -selectcolor green -variable test -command {run_type beam-photon}
$Name.steve.beam add radiobutton -label "Electron"  -background grey -selectcolor green -variable test -command {run_type beam-electron}
E 12
I 12
$Name.steve.beam add radiobutton -label "Photon"  -background grey -activebackground green -selectcolor green -variable test -command {run_type beam-photon}
$Name.steve.beam add radiobutton -label "Electron"  -background grey -activebackground green -selectcolor green -variable test -command {run_type beam-electron}
E 18
I 18
    frame .f27 -bd 2 -bg DeepSkyBlue4
E 18
E 12
E 10
I 6

I 10
D 18
menu $Name.steve.calib -tearoff false
D 12
$Name.steve.calib add radiobutton -label "ADC-Peds"  -background grey -selectcolor green -variable test -command {run_type calib-ADC-peds}
$Name.steve.calib add radiobutton -label "TDC-1872"  -background grey -selectcolor green -variable test -command {run_type calib-TDC-1872}
$Name.steve.calib add radiobutton -label "TOF-laser"  -background grey -selectcolor green -variable test -command {run_type calib-TOF-laser}
$Name.steve.calib add radiobutton -label "TDC-1877"  -background grey -selectcolor green -variable test -command {run_type calib-TDC-1877}
$Name.steve.calib add radiobutton -label "Misc"  -background grey -selectcolor green -variable test -command {run_type calib-misc}
E 12
I 12
$Name.steve.calib add radiobutton -label "ADC-Peds"  -background grey -activebackground green -selectcolor green -variable test -command {run_type calib-ADC-peds}
$Name.steve.calib add radiobutton -label "TDC-1872"  -background grey -activebackground green -selectcolor green -variable test -command {run_type calib-TDC-1872}
$Name.steve.calib add radiobutton -label "TOF-laser"  -background grey -activebackground green -selectcolor green -variable test -command {run_type calib-TOF-laser}
$Name.steve.calib add radiobutton -label "TDC-1877"  -background grey -activebackground green -selectcolor green -variable test -command {run_type calib-TDC-1877}
$Name.steve.calib add radiobutton -label "Misc"  -background grey -activebackground green -selectcolor green -variable test -command {run_type calib-misc}
E 18
I 18
D 57
    label .f27.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Channel config file" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 57
I 57
D 70
    label .f27.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Trigger config file" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 70
I 70
    label .f27.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Run config file" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 70
E 57
    label .f27.number1 -width 47 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable chan_conf -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
E 12


I 18
    pack .f27.label1 -side left -padx 0m
    pack .f27.number1 -side left -padx 1m
E 18

D 18
set Name $Parent.mt26
#------------------------------------------
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 14
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 14
I 14
file_in $Name /usr/local/clas/parms/run_log/last_runtype.txt
E 14
E 12
place $Name -x 535 -relx 0 -y 72 -rely 0 -width 0 -relwidth 0.24 -height 0 -relheight 0.035 -anchor nw 
E 18
I 18
########################################################################
########################## Level1 mask #######################
E 18

E 10
E 6
D 18
set Name $Parent.b15
#------------------------------------------
button $Name -activebackground green1 -bg red1 -command finish -text Done
D 10
place $Name -x 0 -relx 0.5524 -y 0 -rely 0.8967 -width 0 -relwidth 0.20 -height 0 -relheight 0.08 -anchor nw
E 10
I 10
D 13
place $Name -x 0 -relx 0.5224 -y 0 -rely 0.8967 -width 0 -relwidth 0.30 -height 0 -relheight 0.08 -anchor nw
E 13
I 13
place $Name -x 0 -relx 0.5224 -y 0 -rely 0.9167 -width 0 -relwidth 0.30 -height 0 -relheight 0.06 -anchor nw
E 18
I 18
    frame .f28 -bd 2 -bg DeepSkyBlue4
E 18
E 13
E 10

I 18
    label .f28.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Level1 mask " -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f28.number1 -width 47 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable l1_mask -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
I 6

E 6
D 18
set Name $Parent.b16
#------------------------------------------
D 10
button $Name -activebackground green1 -fg black -bg yellow -command old_DB -text "Old DB Entry"  
E 10
I 10
D 16
button $Name -activebackground green1 -fg black -bg yellow -command old_DB -text "Previous Comments Entry"  
E 16
I 16
button $Name -activebackground green1 -fg black -bg yellow -command old_COMMENT -text "Previous Comments Entry"  
E 16
E 10
D 13
place $Name -x 0 -relx 0.1524 -y 0 -rely 0.8967 -width 0 -relwidth 0.30 -height 0 -relheight 0.08 -anchor nw
E 13
I 13
place $Name -x 0 -relx 0.1524 -y 0 -rely 0.9167 -width 0 -relwidth 0.30 -height 0 -relheight 0.06 -anchor nw
E 18
E 13

I 18
    pack .f28.label1 -side left -padx 0m
    pack .f28.number1 -side left -padx 1m
E 18
I 6

E 6
D 18
set Name $Parent.l21
#------------------------------------------
set time [exec date]
label $Name -bg yellow1 -fg black -relief raised -text $time
place $Name -x 8 -relx 0 -y 8 -rely 0 -width 0 -relwidth 0.56 -height 0 -relheight 0.04 -anchor nw
E 18
I 18
########################################################################
########################## prescale #######################
E 18

I 18
    frame .f32 -bd 2 -bg DeepSkyBlue4
E 18
I 6

E 6
D 18
set Name $Parent.t19
#------------------------------------------
text $Name -bg white -borderwidth 3 -fg black -height 5 -width 10 
D 6
set str1 [open  /usr/local/clas/parms/last_crew.txt r]
E 6
I 6
D 16
set str1 [open  /usr/local/clas/parms/run_log/last_crew.txt r]
E 6
set crew [read $str1]
E 16
I 16
set str1 [open  /usr/local/clas/parms/run_log/last_operators.txt r]
set operators [read $str1]
E 16
close $str1
D 16
$Name insert end $crew
E 16
I 16
$Name insert end $operators
E 16
D 10
place $Name -x 16 -relx 0 -y 104 -rely 0 -width 690 -relwidth 0 -height 92 -relheight 0 -anchor nw
E 10
I 10
D 12
place $Name -x 16 -relx 0 -y 84 -rely 0 -width 405 -relwidth 0 -height 46 -relheight 0 -anchor nw
E 12
I 12
place $Name -x 16 -relx 0 -y 84 -rely 0 -width 405 -relwidth 0 -height 53 -relheight 0 -anchor nw
E 18
I 18
    label .f32.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 21 -text "Prescale factor" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f32.number1 -width 47 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable prescale -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
E 12
E 10

I 6

E 6
D 18
set Name $Parent.t21
#------------------------------------------
text $Name -bg white -borderwidth 3 -fg black -height 5 -width 10 -yscrollcommand {.top0.sb23 set}
D 6
#set str2 [open  /usr/local/clas/parms/database.entry r]
E 6
D 16
set db ""
E 16
I 16
set comment ""
E 16
#close $str2
D 16
$Name insert end $db 
E 16
I 16
$Name insert end $comment 
E 16
D 10
place $Name -x 0 -relx 0.06 -y 0 -rely 0.44 -width 0 -relwidth 0.93 -height 0 -relheight 0.43 -anchor nw
E 10
I 10
D 13
place $Name -x 0 -relx 0.06 -y 0 -rely 0.76 -width 0 -relwidth 0.93 -height 0 -relheight 0.12 -anchor nw
E 13
I 13
place $Name -x 0 -relx 0.06 -y 0 -rely 0.79 -width 0 -relwidth 0.93 -height 0 -relheight 0.12 -anchor nw
E 18
I 18
    pack .f32.label1 -side left -padx 0m
    pack .f32.number1 -side left -padx 1m
E 18
E 13
E 10

I 18
########################################################################
########################## level1 discr #######################
E 18
I 6

E 6
D 18
set Name $Parent.sb23
#------------------------------------------
scrollbar $Name -command {.top0.t21 yview}
D 10
place $Name -x 0 -relx 0.02 -y 0 -rely 0.45 -width 0 -relwidth 0.03 -height 0 -relheight 0.41 -anchor nw
E 10
I 10
D 13
place $Name -x 0 -relx 0.02 -y 0 -rely 0.77 -width 0 -relwidth 0.03 -height 0 -relheight 0.10 -anchor nw
E 13
I 13
place $Name -x 0 -relx 0.02 -y 0 -rely 0.80 -width 0 -relwidth 0.03 -height 0 -relheight 0.10 -anchor nw
E 18
I 18
    frame .f29 -bd 2 -bg DeepSkyBlue4
    label .f29.label -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 2 -text "  " 
    label .f29.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 14 -text "L1_thr mV" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f29.label2 -relief raised  -bd 4  -fg black -bg azure3 -width 10 -text "EC_inner" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f29.label3 -relief raised  -bd 4  -fg black -bg azure3 -width 10 -text "EC_outer" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f29.label4 -relief raised  -bd 4  -fg black -bg azure3 -width 10 -text "EC_total" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f29.label5 -relief raised  -bd 4  -fg black -bg azure3 -width 10 -text "SC" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f29.label6 -relief raised  -bd 4  -fg black -bg azure3 -width 10 -text "CC" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
E 13
E 10

I 6

E 6
D 18
set Name $Parent.t12
#------------------------------------------
D 10
text $Name -borderwidth 3 -height 5 -width 10 -bg white -fg black 
E 10
I 10
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
E 10
D 6
set str3 [open  /usr/local/clas/parms/last_target.txt r]
E 6
I 6
set str3 [open  /usr/local/clas/parms/run_log/last_target.txt r]
E 6
D 16
set tar [read $str3]
E 16
I 16
set target [read $str3]
E 16
close $str3
D 16
$Name insert end $tar 
E 16
I 16
$Name insert end $target 
E 16
D 10
place $Name -x 0 -relx 0.14 -y 0 -rely 0.27 -width 0 -relwidth 0.85 -height 0 -relheight 0.08 -anchor nw
E 10
I 10
place $Name -x 0 -relx 0.14 -y 0 -rely 0.19 -width 0 -relwidth 0.42 -height 0 -relheight 0.05 -anchor nw 
E 18
I 18
    pack .f29.label1 -side left -padx 0m
    pack .f29.label2 -side left -padx 0m
    pack .f29.label3 -side left -padx 0m
    pack .f29.label4 -side left -padx 0m
    pack .f29.label5 -side left -padx 0m
    pack .f29.label6 -side left -padx 0m
E 18
E 10

I 10
D 18
set Name $Parent.t26
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 14
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 14
I 14
file_in $Name /usr/local/clas/parms/run_log/last_hvstatus.txt
E 14
E 12
D 15
place $Name -x 0 -relx 0.2 -y 0 -rely 0.245 -width 0 -relwidth 0.36 -height 0 -relheight 0.045 -anchor nw 
E 15
I 15
place $Name -x 0 -relx 0.14 -y 0 -rely 0.245 -width 0 -relwidth 0.42 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
########################################################################
D 71
########################## Level1 high #######################
E 71
I 71
D 74
########################## Level1 A #######################
E 74
I 74
########################## Level1 high #######################
E 74
E 71
    frame .f30 -bd 2 -bg DeepSkyBlue4
    label .f30.label -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 2 -text "  " 
D 71
    label .f30.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 14 -text "High" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 71
I 71
    label .f30.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 14 -text "A" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 71
    label .f30.number1 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable ec_inner_h -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f30.number2 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable ec_outer_h -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f30.number3 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable ec_total_h -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f30.number4 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable sc_h -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f30.number5 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable cc_h -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18
E 15
E 10
I 6

I 10

D 18
set Name $Parent.t28
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
I 17
file_in $Name /usr/local/clas/parms/run_log/last_current_request.txt
E 17
E 12
place $Name -x 0 -relx 0.26 -y 0 -rely 0.295 -width 0 -relwidth 0.30 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
    pack .f30.label1 -side left -padx 0m
#    pack .f30.label -side left -padx 2m
    pack .f30.number1 -side left -padx 0m
    pack .f30.number2 -side left -padx 0m
    pack .f30.number3 -side left -padx 0m
    pack .f30.number4 -side left -padx 0m
    pack .f30.number5 -side left -padx 0m
E 18

D 18
set Name $Parent.t30
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.26 -y 0 -rely 0.345 -width 0 -relwidth 0.30 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
########################################################################
D 71
########################## Level1 lo #######################
E 71
I 71
D 74
########################## Level1 B#######################
E 74
I 74
########################## Level1 lo #######################
E 74
E 71
E 18

D 18
set Name $Parent.t32
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.20 -y 0 -rely 0.395 -width 0 -relwidth 0.36 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
    frame .f31 -bd 2 -bg DeepSkyBlue4
    label .f31.label -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 2 -text "  " 
D 74
    label .f31.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 14 -text "Lo" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 74
I 74
    label .f31.label1 -relief raised  -bd 4  -fg black -bg azure3 -width 14 -text "B" -font -Adobe-Times-Bold-R-Normal-*-140-*
E 74
    label .f31.number1 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable ec_inner_l -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f31.number2 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable ec_outer_l -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f31.number3 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable ec_total_l -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f31.number4 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable sc_l -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f31.number5 -width 10 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable cc_l -font -Adobe-Times-Bold-R-Normal-*-140-*
E 18

D 18
set Name $Parent.t34
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.20 -y 0 -rely 0.445 -width 0 -relwidth 0.36 -height 0 -relheight 0.045 -anchor nw 
E 18

D 18
set Name $Parent.t36
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.24 -y 0 -rely 0.495 -width 0 -relwidth 0.32 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
    pack .f31.label1 -side left -padx 0m
#    pack .f31.label -side left -padx 2m
    pack .f31.number1 -side left -padx 0m
    pack .f31.number2 -side left -padx 0m
    pack .f31.number3 -side left -padx 0m
    pack .f31.number4 -side left -padx 0m
    pack .f31.number5 -side left -padx 0m
E 18

D 18
set Name $Parent.t38
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.24 -y 0 -rely 0.545 -width 0 -relwidth 0.32 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
########################################################################
E 18

D 18
set Name $Parent.t40
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.24 -y 0 -rely 0.595 -width 0 -relwidth 0.32 -height 0 -relheight 0.045 -anchor nw 
E 18

D 18
set Name $Parent.t42
text $Name -borderwidth 1 -height 5 -width 10 -bg white -fg black 
I 12
D 17
file_in $Name /usr/local/clas/parms/run_log/last_target.txt
E 17
E 12
place $Name -x 0 -relx 0.20 -y 0 -rely 0.645 -width 0 -relwidth 0.36 -height 0 -relheight 0.045 -anchor nw 
E 18
I 18
    frame .f3 -bd 2 -bg DeepSkyBlue4
    label .f3.entry -width 5 -fg black -bg azure3 -relief sunken  -bd 3 -textvariable beamcurrent -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f3.label2 -width 5  -bd 4 -fg black -bg azure3 -relief raised  -text "nA" -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f3.label -relief raised  -bd 4  -fg black -bg yellow2 -width 13 -text " I_beam request" -font -Adobe-Times-Bold-R-Normal-*-140-*  
scale .f3.entry2 -orient horizontal -length 8c -from 0 -to 1000 -bg DeepSkyBlue4 -fg DeepSkyBlue4 -command { LL }
    pack .f3.label -side left -padx 0m
    pack .f3.entry -side left -padx 1m
    pack .f3.label2 -side left -padx 1m
    pack .f3.entry2 -side left -padx 0m 
E 18

E 10
E 6
D 18
set Name $Parent.t14
#------------------------------------------
D 9
text $Name -borderwidth 3 -height 2 -width 2 -bg white -fg black 
E 9
I 9
entry $Name -borderwidth 3 -width 15 -bg white -fg black 
E 9
D 6
set str4 [open  /usr/local/clas/parms/last_booknumber.txt r]
E 6
I 6
set str4 [open  /usr/local/clas/parms/run_log/last_booknumber.txt r]
E 6
set bkn [read $str4]
I 9
set bkn  [string trim $bkn]
E 9
close $str4
$Name insert end $bkn 
D 10
place $Name -x 0 -relx 0.45 -y 0 -rely 0.38 -width 0 -relwidth 0.16 -height 0 -relheight 0.05 -anchor nw
E 10
I 10
place $Name -x 0 -relx 0.75 -y 0 -rely 0.128 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
E 10

I 18
set t .f4.label1.target
set t4he .f4.label1.target.4he
set t3he .f4.label1.target.3he
set th2 .f4.label1.target.h2
set td2 .f4.label1.target.4d2
set tweel .f4.label1.target.wheel
set r .f4.label2.raster
E 18

D 6


E 6
D 18
set Name $Parent.t16
#------------------------------------------
D 9
text $Name -borderwidth 3 -height 2 -width 2 -bg white -fg black 
E 9
I 9
entry $Name -borderwidth 3 -width 2 -bg white -fg black 
E 9
D 6
set str5 [open  /usr/local/clas/parms/last_bookpage.txt r]
E 6
I 6
set str5 [open  /usr/local/clas/parms/run_log/last_bookpage.txt r]
E 6
set bkp [read $str5]
close $str5
I 9
set bkp  [string trim $bkp]
E 9
$Name insert end $bkp 
D 10
place $Name -x 0 -relx 0.89 -y 0 -rely 0.38 -width 0 -relwidth 0.10 -height 0 -relheight 0.05 -anchor nw
E 10
I 10
place $Name -x 0 -relx 0.75 -y 0 -rely 0.19 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
I 18
    frame .f4 -bd 2 -bg DeepSkyBlue4
    label .f4.entry1 -width 21 -fg black -relief sunken  -bd 3 -bg azure3 -textvariable target -font -Adobe-Times-Bold-R-Normal-*-140-*
    menubutton .f4.label1 -relief raised  -bd 4 -fg black -bg yellow2  -width 12 -text " Target"  -menu $t -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f4.entry2 -width 11 -fg black -relief sunken  -bd 3 -bg azure3 -textvariable raster -font -Adobe-Times-Bold-R-Normal-*-140-* 
    menubutton .f4.label2 -relief raised  -bd 4 -fg black -bg yellow2  -width 12 -text " Mini raster" -menu $r -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f4.label3 -relief flat  -bd 0 -fg black -bg DeepSkyBlue4  -width 4 -text " " 
E 18
E 10
I 6

I 10
D 18
set Name $Parent.t60
#------------------------------------------
entry $Name -borderwidth 3 -width 2 -bg white -fg black 
I 12
D 17
entry_in $Name /usr/local/clas/parms/run_log/last_bookpage.txt
E 17
E 12
place $Name -x 0 -relx 0.75 -y 0 -rely 0.235 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
I 18
    pack .f4.label1 -side left -padx 0m
    pack .f4.entry1 -side left -padx 1m
    pack .f4.label3 -side left -padx 2m
    pack .f4.label2 -side left -padx 0m
    pack .f4.entry2 -side left -padx 1m 
E 18
E 10

I 10
D 18
set Name $Parent.t62
#------------------------------------------
entry $Name -borderwidth 3 -width 2 -bg white -fg black 
I 12
D 17
entry_in $Name /usr/local/clas/parms/run_log/last_bookpage.txt
E 17
E 12
place $Name -x 0 -relx 0.75 -y 0 -rely 0.285 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
E 10

I 10
D 18
set Name $Parent.t64
#------------------------------------------
entry $Name -borderwidth 3 -width 2 -bg white -fg black 
I 12
D 17
entry_in $Name /usr/local/clas/parms/run_log/last_bookpage.txt
E 17
E 12
place $Name -x 0 -relx 0.75 -y 0 -rely 0.335 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
I 18
menu $t -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
$t add command -label "4He" -command { set target 4He_full}
$t add separator
$t add command -label "3He" -command { set target 3He_full}
$t add separator
$t add command -label "H2" -command { set target H2_full}
$t add separator
$t add command -label "D2" -command { set target D2_full}
$t add separator
I 58
$t add command -label "D2+H2" -command { set target D2+H2}
$t add separator
E 58
I 51
$t add command -label "ND3" -command { set target ND3}
$t add separator
$t add command -label "NH3" -command { set target NH3}
$t add separator
I 72
$t add command -label "N-15" -command { set target N-15}
$t add separator
E 72
$t add command -label "C12" -command { set target C12}
$t add separator
I 56
$t add command -label "56Fe" -command { set target 56Fe}
$t add separator
$t add command -label "CH2" -command { set target CH2}
$t add separator
E 56
E 51
$t add cascade -label "Wheel" -menu $tweel
$t add separator
$t add command -label "Empty"  -command { set target empty}
$t add separator
I 87
$t add command -label "Moller"  -command { set target Moller}
$t add separator
E 87
$t add command -label "Other"  -command { set target other}
E 18

D 18
set Name $Parent.t66
#------------------------------------------
entry $Name -borderwidth 3 -width 2 -bg white -fg black 
I 12
D 17
entry_in $Name /usr/local/clas/parms/run_log/last_bookpage.txt
E 17
E 12
place $Name -x 0 -relx 0.75 -y 0 -rely 0.385 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
I 18
menu $tweel -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* 
$tweel add command -label "Position 1" -command {set target wheel_1}
$tweel add separator
$tweel add command -label "Position 2" -command {set target wheel_2}
$tweel add separator
$tweel add command -label "Position 3" -command {set target wheel_3}
$tweel add separator
$tweel add command -label "Position 4" -command {set target wheel_4}
$tweel add separator
$tweel add command -label "Position 5" -command {set target wheel_5}
$tweel add separator
$tweel add command -label "Position 6" -command {set target wheel_6}
$tweel add separator
$tweel add command -label "Position 7" -command {set target wheel_7}
$tweel add separator
$tweel add command -label "Position 8" -command {set target wheel_8}
$tweel add separator
$tweel add command -label "Position 9" -command {set target wheel_9}
$tweel add separator
$tweel add command -label "Position 10" -command {set target wheel_10}
$tweel add separator
$tweel add command -label "Position 11" -command {set target wheel_11}
$tweel add separator
$tweel add command -label "Position 12" -command {set target wheel_12}
E 18

D 18
set Name $Parent.t68
#------------------------------------------
entry $Name -borderwidth 3 -width 2 -bg white -fg black 
I 12
D 17
entry_in $Name /usr/local/clas/parms/run_log/last_bookpage.txt
E 17
E 12
place $Name -x 0 -relx 0.75 -y 0 -rely 0.435 -width 0 -relwidth 0.24 -height 0 -relheight 0.04 -anchor nw
E 18
I 18
menu $r -tearoff false -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-*
D 22
$r add command -label "On" -command { set raster on} 
E 22
I 22
$r add command -label "On" -command { set raster ON} 
E 22
$r add separator 
D 22
$r add command -label "Off" -command {set raster off }
E 22
I 22
$r add command -label "Off" -command {set raster OFF}
I 78
$r add separator 
$r add command -label "NA" -command {set raster NA}
E 78
E 22
E 18

I 18
    frame .f14 -bd 2 -bg DeepSkyBlue4
    entry .f14.entry -width 55 -fg black -bg azure3 -textvariable shiftcrue -font -Adobe-Times-Bold-R-Normal-*-140-*
    label .f14.label -relief raised  -bd 4 -fg black -bg yellow2 -width 13 -text " Shift oper" -font -Adobe-Times-Bold-R-Normal-*-140-* 
    pack .f14.label -side left
    pack .f14.entry -side left -padx 1m 
E 18

I 12
D 18
set Name $Parent.b510
#------------------------------------------
D 17
checkbutton $Name -text ALL -variable b510 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_all}
E 17
I 17
checkbutton $Name -text INV -variable b510 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_all}
E 17
place $Name -x 0 -relx 0.60 -y 0 -rely 0.50 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
    frame .f15 -bd 2  -bg DeepSkyBlue4 
D 90
    scale .f15.entry1 -orient horizontal -length 3c -from 0 -to 10 -bg DeepSkyBlue4 -command { KK }
E 90
I 90
    scale .f15.entry1 -orient horizontal -length 3c -from 0 -to 10 -bg DeepSkyBlue4 -fg white -command { KK }
E 90
    label .f15.label1 -relief raised  -bd 4 -fg black -bg yellow2 -width 13 -text " Log book" -font -Adobe-Times-Bold-R-Normal-*-140-* 
D 90
    scale .f15.entry2 -orient horizontal -length 3c -from 0 -to 300 -bg DeepSkyBlue4 -command { JJ } 
E 90
I 90
    scale .f15.entry2 -orient horizontal -length 3c -from 0 -to 300 -bg DeepSkyBlue4 -fg white -command { JJ } 
E 90
    label .f15.label2 -relief raised  -bd 4 -fg black -bg yellow2 -width 13 -text " Page" -font -Adobe-Times-Bold-R-Normal-*-140-*
    pack .f15.label1 -side left  
    pack .f15.entry1 -side left -padx 3m 
    pack .f15.label2 -side left -padx 3m 
    pack .f15.entry2 -side left -padx 3m 
E 18
E 12

I 18
    frame .f16 -bd 2 -bg DeepSkyBlue4
    label .f16.label -relief raised  -fg black -bg yellow2 -bd 4 -width 13 -text " Comments" -font -Adobe-Times-Bold-R-Normal-*-140-*
    pack .f16.label -side left
E 18

I 18
    frame .f17 -bd 2 -bg DeepSkyBlue4
    text .f17.text -relief sunken -bd 2 -fg black -bg azure3 -yscrollcommand ".f17.scroll set" -setgrid 1 -height 5 -width 65 -font -Adobe-Times-Bold-R-Normal-*-140-*
D 90
scrollbar .f17.scroll -bg azure3 -command ".f17.text yview"
E 90
I 90
scrollbar .f17.scroll -bg azure3  -command ".f17.text yview"
E 90
pack .f17.scroll -side right -fill y
pack .f17.text 
E 18
D 12
set Name $Parent.b51
#------------------------------------------
checkbutton $Name -text DC-R1 -variable DC-R1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.58 -y 0 -rely 0.62 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12

I 32
#----------- packing all ----------------------------
pack  .f13 .f1 .f3 .f4 .f2 .f21 .f26 .f27 .f28 .f32 .f29 .f30 .f31 .f14 .f15 .f16 .f17    -side top -fill x


I 66
# get the data on date, thresholds, conf files, etc.

set date [exec date]
set newdate $date
catch { exec get_ts_l1mask } result
catch { exec get_prescale_factors } result

# level1 mask read
set f [open ${clonparms}/ts/current_ts_l1mask.txt r]
for {set i 1} { $i<=8} {incr i 1} { gets $f line }
set l1_mask $line
#puts $l1_mask
close $f
set ts_in1 [lindex $line 0]
set ts_in2 [lindex $line 1]
set ts_in3 [lindex $line 2]
set ts_in4 [lindex $line 3]
set ts_in5 [lindex $line 4]
set ts_in6 [lindex $line 5]
set ts_in7 [lindex $line 6]
set ts_in8 [lindex $line 7]
set ts_in9 [lindex $line 8]
set ts_in10 [lindex $line 9]
set ts_in11 [lindex $line 10]
set ts_in12 [lindex $line 11]
puts "$ts_in1 $ts_in2 $ts_in3 $ts_in4 $ts_in5 $ts_in6 $ts_in7 $ts_in8 $ts_in9 $ts_in10 $ts_in11 $ts_in12"
puts "$des_ts_in1 $des_ts_in2 $des_ts_in3 $des_ts_in4 $des_ts_in5 $des_ts_in6 $des_ts_in7 $des_ts_in8 $des_ts_in9 $des_ts_in10 $des_ts_in11 $des_ts_in12"

#=============== Monitor level1 mask =====================================
if { $ts_in1 != $des_ts_in1 || $ts_in2 != $des_ts_in2 || $ts_in3 != $des_ts_in3 || $ts_in4 != $des_ts_in4 || $ts_in5 != $des_ts_in5 || $ts_in6 != $des_ts_in6 || $ts_in7 != $des_ts_in7 || $ts_in8 != $des_ts_in8 || $ts_in9 != $des_ts_in9 || $ts_in10 != $des_ts_in10 || $ts_in11 != $des_ts_in11 || $ts_in12 != $des_ts_in12 } {
toplevel .dlg17 -class Dialog
wm title .dlg17 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg17 $kuku

frame .dlg17.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg17.top -side top -fill both
frame .dlg17.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg17.bot -side bottom -fill both

message .dlg17.top.msg -width 370 -text "Monitored L1 mask does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg17.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg17.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg17
}
button .dlg17.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg17
}
#pack .dlg17.bot.bt1 -side left -expand 1   
#pack .dlg17.bot.bt2 -side left -expand 1   
}
#========================================================================

# prescale read
set f [open ${clonparms}/ts/current_prescale.txt r]
gets $f line 
set prescale $line

D 77
#puts $prescale
E 77
I 77
puts $prescale
E 77
close $f
set ts_pres1 [lindex $line 0]
set ts_pres2 [lindex $line 1]
set ts_pres3 [lindex $line 2]
set ts_pres4 [lindex $line 3]
set ts_pres5 [lindex $line 4]
set ts_pres6 [lindex $line 5]
set ts_pres7 [lindex $line 6]
set ts_pres8 [lindex $line 7]
D 77

E 77
I 77
puts "$ts_pres3 $des_ts_pres3"
E 77
#=============== Monitor Prescale factors ===============================
if { $ts_pres1 != $des_ts_pres1 || $ts_pres2 != $des_ts_pres2 || $ts_pres3 != $des_ts_pres3 || $ts_pres4 != $des_ts_pres4 || $ts_pres5 != $des_ts_pres5 || $ts_pres6 != $des_ts_pres6 || $ts_pres7 != $des_ts_pres7 || $ts_pres8 != $des_ts_pres8 } {
toplevel .dlg8 -class Dialog
wm title .dlg8 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg8 $kuku

frame .dlg8.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg8.top -side top -fill both
frame .dlg8.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg8.bot -side bottom -fill both

message .dlg8.top.msg -width 370 -text "Monitored prescale factors does not agree with the run_configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg8.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg8.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg8
}
button .dlg8.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg8
}
#pack .dlg8.bot.bt1 -side left -expand 1   
#pack .dlg8.bot.bt2 -side left -expand 1   
}
#========================================================================


# trigger conf read

set f [open ${clonparms}/ts/Current.Config r]
gets $f line 
#update
set tfile $line
set atr [split $tfile /]
for { set i 1} { $i < 11} { incr i } {
set atr_f [lindex $atr $i]
D 77
#puts $atr_f
E 77
I 77
puts $atr_f
E 77
 set atr_c [split $atr_f .]
  set atr_cc [lindex $atr_c 1]
D 77
   if { $atr_cc == "trg" } { 
E 77
I 77
puts $atr_cc
D 82
   if { $atr_cc == "trg " } { 
E 82
I 82
   if { $atr_cc == "trg" } { 
E 82
E 77
set trig_conf $atr_f
I 77
puts $trig_conf
#set trig_conf "koko"
E 77
break
}
}
D 77
puts " $trig_conf ++> $des_l1_conf"
E 77
I 77
puts $trig_conf
puts "$tfile|++|$des_l1_conf|++|"
E 77
#=============== Monitor Level1 trigger file ===============================
D 69
if { $trig_conf != $des_l1_conf} {
E 69
I 69
if { $tfile != $des_l1_conf} {
E 69
toplevel .dlg9 -class Dialog
wm title .dlg9 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg9 $kuku

frame .dlg9.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg9.top -side top -fill both
frame .dlg9.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg9.bot -side bottom -fill both

message .dlg9.top.msg -width 370 -text "Level1 tigger configuration does not agree with the run configuration file!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg9.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg9.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg9
}
button .dlg9.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg9
}
#pack .dlg9.bot.bt1 -side left -expand 1   
#pack .dlg9.bot.bt2 -side left -expand 1   
}
#========================================================================
#=============== Monitor Level2 trigger file ===============================
set f [open ${clonparms}/euphrates/euphrates_current.txt r]
gets $f line 
close $f
set l2_conf $line

D 98
puts "$l2_conf ++> $des_l2_conf"
E 98
I 98
puts "$l2_conf ++> ${clonparms}/$des_l2_conf"
E 98

D 92
if { $l2_conf != $des_l2_conf} { 
E 92
I 92
D 98
if { $des_l2_conf != "IGNORE" && $l2_conf != $des_l2_conf } { 
E 98
I 98
if { $des_l2_conf != "IGNORE" && $l2_conf != ${clonparms}/$des_l2_conf } { 
E 98
E 92

toplevel .dlg10 -class Dialog
wm title .dlg10 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg10 $kuku

frame .dlg10.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg10.top -side top -fill both
frame .dlg10.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg10.bot -side bottom -fill both

message .dlg10.top.msg -width 370 -text "Level2 trigger file does not agree with the run configuration file!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg10.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg10.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg10
}
button .dlg10.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg10
}
#pack .dlg10.bot.bt1 -side left -expand 1   
#pack .dlg10.bot.bt2 -side left -expand 1   
}
#========================================================================


#set f [open ${clonparms}/trigger/current_trig_config.txt r]
#gets $f line 
#set trig_conf $line
#puts $trig_conf
#close $f

# channel conf read
set f [open ${clonparms}/trigger/current_trig_config.txt r]
D 70
gets $f line 
set chan_conf $line
E 70
I 70
gets $f line
update
set Ttfile $line
set Tatr [split $Ttfile /]
for { set i 1} { $i < 11} { incr i } {
set Tatr_f [lindex $Tatr $i]
D 93
#puts $Tatr_f
E 93
I 93
puts $Tatr_f
E 93
 set Tatr_c [split $Tatr_f .]
D 83
  set Tatr_cc [lindex $Tatr_c 2]
E 83
I 83
  set Tatr_cc [lindex $Tatr_c 1]
E 83
D 93
#puts $Tatr_cc
E 93
I 93
puts $Tatr_cc
E 93
   if { $Tatr_cc == "cfg" } { 
set Ttfile $Tatr_f
#puts $Ttfile
break
}
}
I 93
D 94
puts "PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP"
E 94
I 94
#puts "PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP"
E 94
E 93
set chan_conf $Ttfile
E 70
close $f
I 70

E 70
set coda_config 888
catch { exec get_coda_config } result 
set f [open ${clonparms}/runsheet/current_coda_config.txt r]
gets $f line 
set coda_config $line
close $f
puts "HEY $chan_conf"
I 85

#---------- Read level1 memory ---------------------------------------------------------
set result 0
set result [ exec l1_memory_check clastrig2 ]
puts $result

if { $result != 0 } {
puts "+++++"
toplevel .dlg19 -class Dialog
wm title .dlg19 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg19 $kuku

frame .dlg19.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg19.top -side top -fill both
frame .dlg19.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg19.bot -side bottom -fill both

message .dlg19.top.msg -width 370 -text "Level1 memory is corrupted!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg19.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg19.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg19
}
button .dlg19.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg19
}
}
#---------- Read level1 memory ---------------------------------------------------------

E 85
E 66
E 32
D 18
set Name $Parent.b511
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable DCR1-1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text CC -variable b511 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  511}
place $Name -x 0 -relx 0.60 -y 0 -rely 0.53 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
#-----------------------------reading the thresholds------------------------------------
#-------------------------------reading ec level1---------------------------------------
D 24
exec diman mon p ec -1 -1
E 24
I 24
D 31
exec dimanc mon p ec -1 -1
E 31
I 31
D 65
catch { exec dimanc mon p ec -1 -1 } result
E 65
I 65
D 66
catch { exec1 dimanc mon p ec -1 -1 } result
E 66
I 66
D 99
catch { exec dimanc mon p ec -1 -1 } result
E 99
I 99
catch { exec dimanc mon p ec } result
E 99
E 66
E 65
E 31
E 24
set f [open $monpath/mon_ec_p.txt r]
E 18
E 12

D 12

E 12
D 18
set Name $Parent.b512
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable DCR1-2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
$Name invoke
E 12
I 12
checkbutton $Name -text 1 -variable b512 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
D 100
for { set i 1} { $i<=6} {incr i 1}  { gets $f line } 
E 100
I 100
#---  skip 6 lines  ----------------------------------------------
for { set i 1} { $i<=7} {incr i 1}  { gets $f line } 
E 100
set ecpin_sec1 [lindex $line 0]
set ecpin_sec2 [lindex $line 1]
set ecpin_sec3 [lindex $line 2]
set ecpin_sec4 [lindex $line 3]
set ecpin_sec5 [lindex $line 4]
set ecpin_sec6 [lindex $line 5]
set ec_inner_h [expr ($ecpin_sec1+$ecpin_sec2+$ecpin_sec3+$ecpin_sec4+$ecpin_sec5+$ecpin_sec6)/6]
gets $f line
set ecpout_sec1 [lindex $line 0]
set ecpout_sec2 [lindex $line 1]
set ecpout_sec3 [lindex $line 2]
set ecpout_sec4 [lindex $line 3]
set ecpout_sec5 [lindex $line 4]
set ecpout_sec6 [lindex $line 5]
set ec_outer_h [expr ($ecpout_sec1+$ecpout_sec2+$ecpout_sec3+$ecpout_sec4+$ecpout_sec5+$ecpout_sec6)/6]
gets $f line
set ecptot_sec1 [lindex $line 0]
set ecptot_sec2 [lindex $line 1]
set ecptot_sec3 [lindex $line 2]
set ecptot_sec4 [lindex $line 3]
set ecptot_sec5 [lindex $line 4]
set ecptot_sec6 [lindex $line 5]
set ec_total_h [expr ($ecptot_sec1+$ecptot_sec2+$ecptot_sec3+$ecptot_sec4+$ecptot_sec5+$ecptot_sec6)/6]
gets $f line
set ecpinlo_sec1 [lindex $line 0]
set ecpinlo_sec2 [lindex $line 1]
set ecpinlo_sec3 [lindex $line 2]
set ecpinlo_sec4 [lindex $line 3]
set ecpinlo_sec5 [lindex $line 4]
set ecpinlo_sec6 [lindex $line 5]
set ec_inner_l [expr ($ecpinlo_sec1+$ecpinlo_sec2+$ecpinlo_sec3+$ecpinlo_sec4+$ecpinlo_sec5+$ecpinlo_sec6)/6]
gets $f line
set ecpoutlo_sec1 [lindex $line 0]
set ecpoutlo_sec2 [lindex $line 1]
set ecpoutlo_sec3 [lindex $line 2]
set ecpoutlo_sec4 [lindex $line 3]
set ecpoutlo_sec5 [lindex $line 4]
set ecpoutlo_sec6 [lindex $line 5]
set ec_outer_l [expr ($ecpoutlo_sec1+$ecpoutlo_sec2+$ecpoutlo_sec3+$ecpoutlo_sec4+$ecpoutlo_sec5+$ecpoutlo_sec6)/6]
gets $f line
set ecptotlo_sec1 [lindex $line 0]
set ecptotlo_sec2 [lindex $line 1]
set ecptotlo_sec3 [lindex $line 2]
set ecptotlo_sec4 [lindex $line 3]
set ecptotlo_sec5 [lindex $line 4]
set ecptotlo_sec6 [lindex $line 5]
set ec_total_l [expr ($ecptotlo_sec1+$ecptotlo_sec2+$ecptotlo_sec3+$ecptotlo_sec4+$ecptotlo_sec5+$ecptotlo_sec6)/6]
close $f
I 66
#=============== Monitor ec level1 thresholds ===============================
set ab1 [ expr abs( $ec_inner_l - $des_ec_inner_l)]
set ab2 [ expr abs( $ec_outer_l - $des_ec_outer_l)]
set ab3 [ expr abs( $ec_total_l - $des_ec_total_l)]
set ab4 [ expr abs( $ec_inner_h - $des_ec_inner_h)]
set ab5 [ expr abs( $ec_outer_h - $des_ec_outer_h)]
set ab6 [ expr abs( $ec_total_h - $des_ec_total_h)]
 
puts "ec pretrig ++> $ab1 $ab2 $ab3 $ab4 $ab5 $ab6 "

D 86
if { $ab1 > 5 || $ab2 > 5 || $ab3 > 5 || $ab4 > 5 || $ab5 > 5 || $ab6 > 5 } {
E 86
I 86
if { $ab1 > 7 || $ab2 > 7 || $ab3 > 7 || $ab4 > 7 || $ab5 > 7 || $ab6 > 7 } {
E 86
toplevel .dlg12 -class Dialog
wm title .dlg12 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg12 $kuku

frame .dlg12.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg12.top -side top -fill both
frame .dlg12.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg12.bot -side bottom -fill both

message .dlg12.top.msg -width 370 -text "Monitored EC thresholds does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg12.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg12.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg12
}
button .dlg12.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg12
}
#pack .dlg12.bot.bt1 -side left -expand 1   
#pack .dlg12.bot.bt2 -side left -expand 1   
}
#========================================================================

E 66
#--------------------------------------------------------------------------------------
#-----------------------------reading cc level1----------------------------------------
D 24
exec diman mon p cc -1 -1
E 24
I 24
D 31
exec dimanc mon p cc -1 -1
E 31
I 31
D 99
catch { exec dimanc mon p cc -1 -1 } result
E 99
I 99
catch { exec dimanc mon p cc } result
E 99
E 31
E 24
set f [open $monpath/mon_cc_p.txt r]
E 18
E 12

I 18
D 100
for { set i 1} { $i<=4} {incr i 1}  { gets $f line } 
E 100
I 100
#---  skip 5 lines  ----------------------------------------------
for { set i 1} { $i<=6} {incr i 1}  { gets $f line } 
E 100
set cctivhigh1 [lindex $line 0]
set cctivlo1 [lindex $line 1]
set cctivhigh2 [lindex $line 2]
set cctivlo2 [lindex $line 3]
set thr1 $cctivhigh1
set thr2 $cctivlo1
set thr11 $cctivhigh2
set thr22 $cctivlo2
set cc_h [ expr ($cctivhigh1+$cctivhigh2)/2]
set cc_l [ expr ($cctivlo1+$cctivlo2)/2]
close $f
I 66
set cc_pretrig [ expr ( $cc_h + $cc_l)/2]
set ab1 [ expr abs( $cc_pretrig - $des_cc_pretrig)]
puts "cc pretrig ++> $ab1"

#=============== Monitor cc level1 thresholds ===============================
D 86
if { $ab1>5 } {
E 86
I 86
if { $ab1>7 } {
E 86
toplevel .dlg13 -class Dialog
wm title .dlg13 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg13 $kuku

frame .dlg13.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg13.top -side top -fill both
frame .dlg13.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg13.bot -side bottom -fill both

message .dlg13.top.msg -width 370 -text "Monitored CC thresholds does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg13.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg13.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg13
}
button .dlg13.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg13
}
#pack .dlg13.bot.bt1 -side left -expand 1   
#pack .dlg13.bot.bt2 -side left -expand 1   
}
#========================================================================

E 66
#---------------------------------------------------------------------------------------
#-----------------------------reading sc level1-----------------------------------------
D 24
exec diman mon p sc -1 -1
E 24
I 24
D 31
exec dimanc mon p sc -1 -1
E 31
I 31
D 99
catch { exec dimanc mon p sc -1 -1 } result
E 99
I 99
catch { exec dimanc mon p sc } result
E 99
E 31
E 24
set f [open $monpath/mon_sc_p.txt r]
E 18

D 18
set Name $Parent.b513
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable DCR1-3 -anchor nw -activebackground green -background grey -selectcolor green 
place $Name -x 0 -relx 0.77 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
$Name invoke
E 12
I 12
checkbutton $Name -text 2 -variable b513 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
D 100
for { set i 1} { $i<=3} {incr i 1}  { gets $f line } 
E 100
I 100
#---  skip 5 lines  ----------------------------------------------
for { set i 1} { $i<=5} {incr i 1}  { gets $f line } 
E 100
set i 0
set scthmean 0
set scwidmean 0 
D 100
    while {[gets $f line ] >= 0 } {
E 100
I 100
    while { ([gets $f line ] >= 0) && ([string length $line] > 0) } {
E 100
incr i
set scthr_pg($i) [lindex $line 0]
set scthmean [expr $scthmean+$scthr_pg($i)]
}
set sc_h [expr $scthmean/$i]
set sc_l -
close $f
I 66
set ab1 [ expr abs( $sc_h - $des_sc_pretrig)]
puts "sc pretrig ++> $ab1"
#=============== Monitor sc level1 thresholds ===============================
D 86
if { $ab1>5 } {
E 86
I 86
if { $ab1>7 } {
E 86
toplevel .dlg14 -class Dialog
wm title .dlg14 "Alarm"
set kuku [expr $kuku+100]
positionWindow .dlg14 $kuku

frame .dlg14.top -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg14.top -side top -fill both
frame .dlg14.bot -relief raised -bd 1 -bg DeepSkyBlue4
pack .dlg14.bot -side bottom -fill both

message .dlg14.top.msg -width 370 -text "Monitored SC thresholds does not agree with the run configuration file settings!" -font -Adobe-Times-Bold-R-Normal-*-180-*
pack .dlg14.top.msg -side right -expand 1 -fill both -padx 3m -pady 3m

button .dlg14.bot.bt1 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Ok -relief raised  -bd 7 -command {
    destroy .dlg14
}
button .dlg14.bot.bt2 -width 11 -fg black -bg azure3 -font -Adobe-Times-Bold-R-Normal-*-140-* -text Cancel -relief raised  -bd 7 -command {
destroy .dlg14
}
#pack .dlg14.bot.bt1 -side left -expand 1   
#pack .dlg14.bot.bt2 -side left -expand 1   
}
#========================================================================

E 66
#---------------------------------------------------------------------------------------
set new_ec_inner_h $ec_inner_h
set new_ec_outer_h $ec_outer_h
set new_ec_total_h $ec_total_h
set new_sc_h $sc_h
set new_cc_h $cc_h
set new_ec_inner_l $ec_inner_l
set new_ec_outer_l $ec_outer_l
set new_ec_total_l $ec_total_l
set new_sc_l $sc_l
set new_cc_l $cc_l
E 18
E 12

I 18
D 32
pack  .f13 .f1 .f3 .f4 .f2 .f21 .f26 .f27 .f28 .f32 .f29 .f30 .f31 .f14 .f15 .f16 .f17    -side top -fill x
E 32
I 32

E 32
#focus .f1.entry
E 18
I 12
D 66

E 12
D 18
set Name $Parent.b514
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable DCR1-4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
$Name invoke
E 12
I 12
checkbutton $Name -text 3 -variable b514 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
E 12


D 18
set Name $Parent.b515
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable DCR1-5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 4 -variable b515 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
D 45
proc writefile { } {
global archivfile arcomment aropper texto j
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale
I 26
global env clonparms clonwsrc
E 45
E 26
E 18
E 12

I 18
D 45
if { $runtype == " "} { set runtype *}
if { $raster == " "} { set raster *}
if { $logbook == " "} { set logbook 0}
if { $page == " "} { set page 0}
E 18

D 18
set Name $Parent.b516
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable DCR1-6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b516 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
puts  "$date $runtype $runnum $beamcurrent $target $raster $tk_b_ener $tk_t_cur $tk_mt_cur $trig_conf $chan_conf $ec_inner_h $ec_outer_h $ec_total_h $sc_h $cc_h $ec_inner_l $ec_outer_l $ec_total_l $sc_l $cc_l $logbook $page " 
E 18
E 12

I 18
set f [open $archivfile w+]
puts $f " $runtype $beamcurrent $target $raster $logbook $page "
E 18

D 12
set Name $Parent.b53
E 12
I 12
D 18
set Name $Parent.b517
E 12
#------------------------------------------
D 12
checkbutton $Name -text DC-R2 -variable DC-R2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.58 -y 0 -rely 0.65 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b517 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
close $f
E 18
E 12

I 18
set ff [open $aropper w+]
puts $ff "$shiftcrue "
close $ff
E 18
D 12
set Name $Parent.b531
E 12
I 12

D 18
set Name $Parent.b518
E 12
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable DCR2-1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text EGN -variable b518 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  518}
place $Name -x 0 -relx 0.60 -y 0 -rely 0.56 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
set ff [open $arcomment w+]
puts $f  $comment 
close $f
E 18
E 12

I 19
printsheet

E 19
I 18
}
E 18

D 12
set Name $Parent.b532
E 12
I 12
D 18
set Name $Parent.b519
E 12
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable DCR2-2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 1 -variable b519 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
E 12

I 18
proc readfile  { } {
global archivfile arcomment aropper texto j
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h ec_outer_h ec_total_h sc_h cc_h ec_inner_l ec_outer_l ec_total_l sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale
I 26
global env clonparms clonwsrc
E 26
E 18

D 12
set Name $Parent.b533
E 12
I 12
D 18
set Name $Parent.b520
E 12
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable DCR2-3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 2 -variable b520 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
#puts "SIMON $j"
set f [open $archivfile r]
gets $f line
set runtype [lindex $line 0] 
set beamcurrent [lindex $line 1]
D 43
#puts $beamcurrent
E 43
I 43
D 44
puts $beamcurrent
E 44
I 44
#puts $beamcurrent
E 44
E 43
$beamcr_scale set [expr $beamcurrent*10.0]
set target [lindex $line 2]
set raster [lindex $line 3]
set logbook [lindex $line 4]
$logbook_scale set $logbook
set page [lindex $line 5]
$page_scale set $page
close $f
E 18
E 12


D 12
set Name $Parent.b534
E 12
I 12
D 18
set Name $Parent.b521
E 12
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable DCR2-4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 3 -variable b521 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
set f [open $aropper r]
gets $f line
set  shiftcrue $line
I 44
regsub -all {'} $shiftcrue {''} shiftcrue
E 44
close $f
E 18
E 12

I 18
}
E 18

D 12
set Name $Parent.b535
E 12
I 12
D 18
set Name $Parent.b522
E 12
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable DCR2-5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 4 -variable b522 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
proc printsheet { } {
I 38
D 42
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling runtype
E 42
I 42
global photon_trig_conf radiator scaler_config1 scaler_config2 scaler_config3 scaler_config4 PS_converter collimator1 collimator2 PC_converter TAC RadPhi et_coincidence tagger_prescaling runtype Tag_cur
E 42
E 38
I 19

I 38

E 38
E 19
D 22
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h  ec_outer_h ec_total_h  cc_h ec_inner_l ec_outer_l ec_total_l sc_h sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale l1_mask prescale comment printfile
E 22
I 22
global date runtype runnum beamcurrent target raster tk_b_ener tk_t_cur tk_mt_cur trig_conf chan_conf ec_inner_h  ec_outer_h ec_total_h  cc_h ec_inner_l ec_outer_l ec_total_l sc_h sc_l cc_l shiftcrue logbook page comment beamcr_scale logbook_scale page_scale l1_mask prescale comment printfile env
I 26
global env clonparms clonwsrc
E 26
E 22
E 18
E 12

I 18
D 19
set f [open $printfile w]
E 19
I 19
D 22
#set session [exec /home/gurjyan/bin/session]
set session clasprod_
set f [open /usr/local/clas/parms/run_log/archive/comment_$session$runnum.txt w]
E 22
I 22
set rootdir $env(CLON_PARMS)
D 23
set session $env(DD_NAME)
E 23
I 23
if {[catch {set env(DD_NAME)}]==1} {
    set session "clasprod"
} else {
    set session $env(DD_NAME)
}
E 23
set exten [format "%06d" $runnum]
set f [open ${rootdir}/run_log/archive/comment_${session}_${exten}.txt w]
E 22
E 19
E 18

D 12
set Name $Parent.b536
E 12
I 12
D 18
set Name $Parent.b523
E 12
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable DCR2-6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b523 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
D 20
puts $f "                              Run Sheet                                  "
puts $f "-------------------------------------------------------------------------"
D 19
puts $f " Date - $date "
puts $f " Run Type - $runtype               Run Number - $runnum" 
puts $f " I_beam request - $beamcurrent"                          
puts $f " Target - $target                  Mini raster - $raster"
puts $f " Beam energy - $tk_b_ener Mev      I_Torus - $tk_t_cur A"
puts $f " I_Minitorus - $tk_mt_cur    "
puts $f " Trigger config. file - $trig_conf"
puts $f " Channel config. file - $chan_conf"
puts $f " level1 mask - $l1_mask"
puts $f " Prescale factor - $prescale"
puts $f " L1 high thresholds in Mv  "
puts $f " EC_inner  -   $ec_inner_h  "
puts $f " EC_outer  -   $ec_outer_h "
puts $f " EC_total  -   $ec_total_h  "
puts $f " SC        -   $sc_h  "
puts $f " CC        -   $cc_h "
puts $f " L1 lo thresholds in Mv  "
puts $f " EC_inner  -   $ec_inner_l  "
puts $f " EC_outer  -   $ec_outer_l "
puts $f " EC_total  -   $ec_total_l  "
puts $f " SC        -   $sc_l  "
puts $f " CC        -   $cc_l "
puts $f " Shift oper. - $shiftcrue"
puts $f " Log book - $logbook                 Page - $page"
puts $f "Comment "
E 19
I 19
puts $f " *Date* - $date "
puts $f " "
puts $f " *Run Type* - $runtype"
puts $f " "
puts $f " *Run Number* - $runnum" 
puts $f " "
puts $f " *I_beam request* - $beamcurrent"                          
puts $f " "
puts $f " *Target* - $target"
puts $f " "
puts $f " *Mini raster* - $raster"
puts $f " "
puts $f " *Beam energy* - $tk_b_ener Mev"
puts $f " "      
puts $f " *I_Torus* - $tk_t_cur A"
puts $f " "
puts $f " *I_Minitorus* - $tk_mt_cur    "
puts $f " "
E 20
I 20
D 42
puts $f "#  generated by run_log_comment on [exec date]" 
E 42
I 42
puts $f "#  Generated by run_log_comment on [exec date]" 
E 42
puts $f ""
D 42
puts $f "*DATE* - $date "
puts $f ""
puts $f "*RUN_TYPE* - $runtype"
puts $f ""
puts $f "*RUN_NUMBER* - $runnum" 
puts $f ""
puts $f "*BEAM_REQUEST* - $beamcurrent"                          
puts $f ""
puts $f "*TARGET* - $target"
puts $f ""
puts $f "*MINI_RASTER* - $raster"
puts $f ""
puts $f "*BEAM_ENERGY* - $tk_b_ener Mev"
puts $f ""      
puts $f "*TORUS_CURRENT* - $tk_t_cur A"
puts $f ""
puts $f "*MINI_CURRENT* - $tk_mt_cur    "
puts $f ""
E 42
I 42
puts $f "      DATE             - $date "
puts $f "      RUN_TYPE         - $runtype"
puts $f "      RUN_NUMBER       - $runnum" 
puts $f "      BEAM_REQUEST     - $beamcurrent  nA"                          
puts $f "      TARGET           - $target"
puts $f "      MINI_RASTER      - $raster"
puts $f "      BEAM_ENERGY      - $tk_b_ener Mev"
puts $f "      TORUS_CURRENT    - $tk_t_cur A"
puts $f "      MINI_CURRENT     - $tk_mt_cur    "
E 42
E 20
D 44
set a [split $trig_conf /]
set b [split $chan_conf /]
set p [lindex $a 7]
set c [lindex $b 7]
D 20
puts $f " *Trigger config. file* - $p"
puts $f " "
puts $f " *Channel config. file* - $c"
puts $f " "
puts $f " *level1 mask* - $l1_mask"
puts $f " "
puts $f " *Prescale factor* - $prescale"
puts $f " "
puts $f " *L1 high thresholds in Mv*  "
puts $f " *EC_inner*  -   $ec_inner_h  "
puts $f " *EC_outer*  -   $ec_outer_h "
puts $f " *EC_total*  -   $ec_total_h  "
puts $f " *SC*        -   $sc_h  "
puts $f " *CC*        -   $cc_h "
puts $f " "
puts $f " *L1 lo thresholds in Mv*  "
puts $f " *EC_inner*  -   $ec_inner_l  "
puts $f " *EC_outer*  -   $ec_outer_l "
puts $f " *EC_total*  -   $ec_total_l  "
puts $f " *SC*        -   $sc_l  "
puts $f " *CC*        -   $cc_l "
puts $f " "
puts $f " *Shift oper.* - $shiftcrue"
puts $f " "
puts $f " *Log book* - $logbook "
puts $f " "
puts $f " *Page* - $page"
puts $f " "
puts $f " *ignore*  "
puts $ "    N "
puts $f " "
puts $f " *Comment* "
puts $f " "
E 20
I 20
D 42
puts $f "*TRIG_CONFIG* - $p"
E 42
I 42
puts $f "      TRIG_CONFIG      - $p"
puts $f "      CHANNEL_CONFIG   - $c"
E 44
I 44
#set a [split $trig_conf /]
#set b [split $chan_conf /]
#set p [lindex $a 7]
#set c [lindex $b 7]
puts $f "      TIGRIS           - $trig_conf"
puts $f "      CHANNEL_CONFIG   - unused"
E 44
puts $f "      L1_MASK          - $l1_mask"
puts $f "      PRESCALE         - $prescale"
E 42
puts $f ""
D 42
puts $f "*CHANNEL_CONFIG* - $c"
E 42
I 42
puts $f "      L1 lo thresholds in Mv             L1 high thresholds in Mv   "
puts $f "      EC_INNER_LO   -   $ec_inner_l           EC_INNER_HI   -   $ec_inner_h  "
puts $f "      EC_OUTER_LO   -   $ec_outer_l           EC_OUTER_HI   -   $ec_outer_h "
puts $f "      EC_TOTAL_LO   -   $ec_total_l           EC_TOTAL_HI   -   $ec_total_h"
puts $f "      SC_LO         -   $sc_l            SC_HI         -   $sc_h  "
puts $f "      CC_LO         -   $cc_l          CC_HI         -   $cc_h "
E 42
puts $f ""
D 42
puts $f "*L1_MASK* - $l1_mask"
puts $f ""
puts $f "*PRESCALE* - $prescale"
puts $f ""
D 41
puts $f "*L1 high thresholds in Mv*  "
puts $f "*EC_INNER_HI*  -   $ec_inner_h  "
puts $f "*EC_OUTER_HI*  -   $ec_outer_h "
puts $f "*EC_TOTAL_HI*  -   $ec_total_h  "
puts $f "*SC_HI*        -   $sc_h  "
puts $f "*CC_HI*        -   $cc_h "
E 41
I 41
puts $f "*L1 lo thresholds in Mv*           *L1 high thresholds in Mv*  "
puts $f "*EC_INNER_LO*  -   $ec_inner_l   *EC_INNER_HI*  -   $ec_inner_h  "
puts $f "*EC_OUTER_LO*  -   $ec_outer_l   *EC_OUTER_HI*  -   $ec_outer_h "
puts $f "*EC_TOTAL_LO*  -   $ec_total_l   *EC_TOTAL_HI*  -   $ec_total_h"
puts $f "*SC_LO*        -   $sc_l         *SC_HI*        -   $sc_h  "
puts $f "*CC_LO*        -   $cc_l         *CC_HI*        -   $cc_h "
E 41
puts $f ""
E 42
D 41
puts $f "*L1 lo thresholds in Mv*  "
puts $f "*EC_INNER_LO*  -   $ec_inner_l  "
puts $f "*EC_OUTER_LO*  -   $ec_outer_l "
puts $f "*EC_TOTAL_LO*  -   $ec_total_l  "
puts $f "*SC_LO*        -   $sc_l  "
puts $f "*CC_LO*        -   $cc_l "
puts $f ""
E 41
I 34
if { $runtype == "photon" } {
I 43

E 43
puts $f " ======= Photon Run ==========="
puts $f ""
D 42
puts $f "*Photon Trigger*  - $photon_trig_conf"
puts $f ""
puts $f "*Radiator*  - $radiator"
puts $f ""
puts $f "*Scaler Gate*  - $scaler_config1 $scaler_config2 $scaler_config3 $scaler_config4 "
puts $f ""
D 39
puts $f "*PS_convertor*  - $PS_convertor"
E 39
I 39
D 41
puts $f "*PS_convertor*  - $PS_converter"
E 41
I 41
puts $f "*PS_convertor*  - $PS_converter ,  *PC*  - $PC_converter "
E 41
E 39
puts $f ""
D 39
puts $f "*PC*  - $PC_convertor"
E 39
I 39
D 41
puts $f "*PC*  - $PC_converter"
E 41
I 41
puts $f "*TAC*  - $TAC  ,    *RadPhi*  - $RadPhi ,  *ET_coincidence*  - $et_coincidence"
E 41
E 39
puts $f ""
D 39
puts $f "*TAC*  - $TAC_convertor"
E 39
I 39
D 41
puts $f "*TAC*  - $TAC"
E 41
I 41
puts $f "*Collimator1*  - $collimator1 ,  *Collimator2*  - $collimator2"
E 41
E 39
puts $f ""
D 41
puts $f "*Collimator1*  - $collimator1"
puts $f ""
puts $f "*Collimator2*  - $collimator2"
puts $f ""
D 39
puts $f "*RadPhi*  - $radPhi"
E 39
I 39
puts $f "*RadPhi*  - $RadPhi"
E 39
puts $f ""
puts $f "*ET_coincidence*  - $et_coincidence"
puts $f ""
E 41
puts $f "*Tagger_prescaling*  - $tagger_prescaling"
E 42
I 42
puts $f "      Photon Trigger        - $photon_trig_conf"
puts $f "      Radiator              - $radiator"
puts $f "      Scaler Gate           - $scaler_config1 $scaler_config2 $scaler_config3 $scaler_config4 "
puts $f "      PS_convertor          - $PS_converter "
puts $f "      PC                    - $PC_converter "
puts $f "      TAC                   - $TAC  "
puts $f "      RadPhi                - $RadPhi "
puts $f "      ET_coincidence        - $et_coincidence"
puts $f "      Collimator1           - $collimator1 "
puts $f "      Collimator2           - $collimator2"
puts $f "      Tagger_prescaling     - $tagger_prescaling"
I 43

#------ appendiong the file ----------
set g [ open /home/clasrun/progress/g1/progress_lol.txt a] 
D 44
puts $g "$runnum  $p   $beamcurrent  $radiator    00     $tk_t_cur   $Tag_cur   $target   \"     \"   $photon_trig_conf  $collimator1  $RadPhi $PC_converter  $TAC "  
E 44
I 44
puts $g "$runnum  $trig_conf   $beamcurrent  $radiator    00     $tk_t_cur   $Tag_cur   $target   \"     \"   $photon_trig_conf  $collimator1  $RadPhi $PC_converter  $TAC "  
E 44
close $g


E 43
E 42
}
E 34
D 42
puts $f "*OPERATORS* - $shiftcrue"
E 42
puts $f ""
D 42
puts $f "*LOG_BOOK* - $logbook "
E 42
I 42
puts $f "      OPERATORS  - $shiftcrue"
E 42
puts $f ""
D 42
puts $f "*LOG_PAGE* - $page"
E 42
I 42
puts $f "      LOG_BOOK  - $logbook "
E 42
puts $f ""
D 22
puts $f "*IGNORE*  "
puts $f "   N "
E 22
I 22
D 42
puts $f "*IGNORE*"
E 42
I 42
puts $f "      LOG_PAGE  - $page"
puts $f ""
puts $f " IGNORE "
E 42
puts $f "N"
E 22
puts $f ""
D 22
puts $f "*COMMENT* "
E 22
I 22
D 42
puts $f "*COMMENT*"
E 42
I 42
puts $f "      COMMENT "
E 42
E 22
puts $f ""
E 20
E 19
puts $f $comment
E 18
E 12

I 18
close $f
E 18

I 42
D 43
#------ appendiong the file ----------
set g [ open /home/clasrun/progress/g1/progress_lol.txt a] 
puts $g "$runnum  $p   $beamcurrent  $radiator    00     $tk_t_cur   $Tag_cur   $target   \"     \"   $photon_trig_conf  $collimator1  $RadPhi $PC_converter  $TAC "  
close $g
E 43

E 42
D 12

set Name $Parent.b55
E 12
I 12
D 18
set Name $Parent.b524
E 12
#------------------------------------------
D 12
checkbutton $Name -text DC-R3 -variable DC-R3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.58 -y 0 -rely 0.68 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b524 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 18
I 18
D 19
exec lp -dclonhp $printfile
E 19
I 19
D 22
exec lp -dclonhp /usr/local/clas/parms/run_log/archive/comment_$session$runnum.txt 
E 22
I 22
D 23
exec lp -dclonhp ${rootdir}/run_log/archive/comment_${session}_${runnum}.txt 
E 23
I 23
D 31
exec lp -dclonhp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt 
E 31
I 31
catch { exec lp -dclonhp ${rootdir}/run_log/archive/comment_${session}_${exten}.txt } result 
E 31
E 23

E 22
E 19
}
E 18
E 12


E 45
D 12
set Name $Parent.b551
E 12
I 12
D 18
set Name $Parent.b525
E 12
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable DCR3-1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text TOF -variable b525 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  525}
place $Name -x 0 -relx 0.60 -y 0 -rely 0.59 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b552
E 12
I 12
set Name $Parent.b526
E 12
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable DCR3-2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 1 -variable b526 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b553
E 12
I 12
set Name $Parent.b527
E 12
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable DCR3-3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 2 -variable b527 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b554
E 12
I 12
set Name $Parent.b528
E 12
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable DCR3-4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 3 -variable b528 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b555
E 12
I 12
set Name $Parent.b529
E 12
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable DCR3-5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 4 -variable b529 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b556
E 12
I 12
set Name $Parent.b530
E 12
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable DCR3-6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b530 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b56
E 12
I 12
set Name $Parent.b531
E 12
#------------------------------------------
D 12
checkbutton $Name -text LAC -variable LAC -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.58 -y 0 -rely 0.71 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b531 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12

I 12
set Name $Parent.b532
#------------------------------------------
checkbutton $Name -text DC-R1 -variable b532 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  532}
place $Name -x 0 -relx 0.58 -y 0 -rely 0.62 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12

D 12
set Name $Parent.b561
E 12
I 12
set Name $Parent.b533
E 12
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable LAC1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 1 -variable b533 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b562
E 12
I 12
set Name $Parent.b534
E 12
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable LAC2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 2 -variable b534 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b563
E 12
I 12
set Name $Parent.b535
E 12
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable LAC3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 3 -variable b535 -anchor nw -activebackground green -background grey -selectcolor green 
place $Name -x 0 -relx 0.77 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12

I 12
set Name $Parent.b536
#------------------------------------------
checkbutton $Name -text 4 -variable b536 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12

D 12
set Name $Parent.b564
E 12
I 12

set Name $Parent.b537
E 12
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable LAC4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b537 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b565
E 12
I 12
set Name $Parent.b538
E 12
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable LAC5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b538 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.62 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b566
E 12
I 12
set Name $Parent.b539
E 12
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable LAC6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text DC-R2 -variable b539 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  539}
place $Name -x 0 -relx 0.58 -y 0 -rely 0.65 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12

I 12
set Name $Parent.b540
#------------------------------------------
checkbutton $Name -text 1 -variable b540 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b57
E 12
I 12
set Name $Parent.b541
E 12
#------------------------------------------
D 12
checkbutton $Name -text TOF -variable TOF -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.60 -y 0 -rely 0.59 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 2 -variable b541 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b571
E 12
I 12
set Name $Parent.b542
E 12
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable TOF1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 3 -variable b542 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b572
E 12
I 12
set Name $Parent.b543
E 12
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable TOF2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 4 -variable b543 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b573
E 12
I 12
set Name $Parent.b544
E 12
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable TOF3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b544 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b574
E 12
I 12
set Name $Parent.b545
E 12
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable TOF4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b545 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.65 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b575
E 12
I 12

set Name $Parent.b546
E 12
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable TOF5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text DC-R3 -variable b546 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  546}
place $Name -x 0 -relx 0.58 -y 0 -rely 0.68 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b576
E 12
I 12
set Name $Parent.b547
E 12
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable TOF6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.59 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 1 -variable b547 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


I 12
set Name $Parent.b548
#------------------------------------------
checkbutton $Name -text 2 -variable b548 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12

D 12
set Name $Parent.b59
E 12
I 12

set Name $Parent.b549
E 12
#------------------------------------------
D 12
checkbutton $Name -text EGN -variable EGN -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.60 -y 0 -rely 0.56 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 3 -variable b549 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b591
E 12
I 12
set Name $Parent.b550
E 12
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable EGN1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 4 -variable b550 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b592
E 12
I 12
set Name $Parent.b551
E 12
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable EGN2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b551 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b593
E 12
I 12
set Name $Parent.b552
E 12
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable EGN3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b552 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.68 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b594
E 12
I 12
set Name $Parent.b553
E 12
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable EGN4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text LAC -variable b553 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  553}
place $Name -x 0 -relx 0.58 -y 0 -rely 0.71 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b554
#------------------------------------------
checkbutton $Name -text 1 -variable b554 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b595
E 12
I 12
set Name $Parent.b555
E 12
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable EGN5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 2 -variable b555 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b596
E 12
I 12
set Name $Parent.b556
E 12
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable EGN6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.56 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 3 -variable b556 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12

set Name $Parent.b61
E 12
I 12
set Name $Parent.b557
E 12
#------------------------------------------
D 12
checkbutton $Name -text CC -variable CC -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.60 -y 0 -rely 0.53 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 4 -variable b557 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12

D 12
set Name $Parent.b611
E 12
I 12

set Name $Parent.b558
E 12
#------------------------------------------
D 12
checkbutton $Name -text 1 -variable CC1 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 5 -variable b558 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


D 12
set Name $Parent.b612
E 12
I 12
set Name $Parent.b559
E 12
#------------------------------------------
D 12
checkbutton $Name -text 2 -variable CC2 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
checkbutton $Name -text 6 -variable b559 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.71 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12

D 13

E 13
D 12
set Name $Parent.b613
E 12
I 12
set Name $Parent.b560
E 12
#------------------------------------------
D 12
checkbutton $Name -text 3 -variable CC3 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
D 13
checkbutton $Name -text A -variable b560 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 560 512}
place $Name -x 0 -relx 0.67 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
I 13
checkbutton $Name -text LATOF -variable b560 -anchor nw -activebackground green -background grey -selectcolor green -command {highlight_row  560}
place $Name -x 0 -relx 0.58 -y 0 -rely 0.74 -width 0 -relwidth 0.09 -height 0 -relheight 0.03 -anchor nw
E 13
E 12


D 12
set Name $Parent.b614
E 12
I 12
set Name $Parent.b561
E 12
#------------------------------------------
D 12
checkbutton $Name -text 4 -variable CC4 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
D 13
checkbutton $Name -text A -variable b561 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 561 513}
place $Name -x 0 -relx 0.72 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
I 13
checkbutton $Name -text 1 -variable b561 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.67 -y 0 -rely 0.74 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
E 12


D 12
set Name $Parent.b615
E 12
I 12
set Name $Parent.b562
E 12
#------------------------------------------
D 12
checkbutton $Name -text 5 -variable CC5 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
D 13
checkbutton $Name -text A -variable b562 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 562 514}
place $Name -x 0 -relx 0.77 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
I 13
checkbutton $Name -text 2 -variable b562 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.72 -y 0 -rely 0.74 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
E 12


D 12
set Name $Parent.b616
E 12
I 12
set Name $Parent.b563
E 12
#------------------------------------------
D 12
checkbutton $Name -text 6 -variable CC6 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.53 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
D 13
checkbutton $Name -text A -variable b563 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 563 515}
place $Name -x 0 -relx 0.82 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
I 13
checkbutton $Name -text 3 -variable b563 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.77 -y 0 -rely 0.74 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
E 12


I 12
set Name $Parent.b564
#------------------------------------------
D 13
checkbutton $Name -text A -variable b564 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 564 516}
place $Name -x 0 -relx 0.87 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
I 13
checkbutton $Name -text 4 -variable b564 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.82 -y 0 -rely 0.74 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 13
E 12

D 12
set Name $Parent.b63
E 12
I 12

set Name $Parent.b565
E 12
#------------------------------------------
D 12
checkbutton $Name -text ALL -variable TAG -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.60 -y 0 -rely 0.50 -width 0 -relwidth 0.07 -height 0 -relheight 0.03 -anchor nw
E 12
I 12
D 13
checkbutton $Name -text A -variable b565 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 565 517}
E 13
I 13
checkbutton $Name -text 5 -variable b565 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.87 -y 0 -rely 0.74 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b566
#------------------------------------------
checkbutton $Name -text 6 -variable b566 -anchor nw -activebackground green -background grey -selectcolor green
place $Name -x 0 -relx 0.92 -y 0 -rely 0.74 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b567
#------------------------------------------
checkbutton $Name -text A -variable b567 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 567 512}
place $Name -x 0 -relx 0.67 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b568
#------------------------------------------
checkbutton $Name -text A -variable b568 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 568 513}
place $Name -x 0 -relx 0.72 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b569
#------------------------------------------
checkbutton $Name -text A -variable b569 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 569 514}
place $Name -x 0 -relx 0.77 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b570
#------------------------------------------
checkbutton $Name -text A -variable b570 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 570 515}
place $Name -x 0 -relx 0.82 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b571
#------------------------------------------
checkbutton $Name -text A -variable b571 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 571 516}
place $Name -x 0 -relx 0.87 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw


set Name $Parent.b572
#------------------------------------------
checkbutton $Name -text A -variable b572 -anchor nw -activebackground green -background grey -selectcolor green -command {invert_col 572 517}
E 13
place $Name -x 0 -relx 0.92 -y 0 -rely 0.50 -width 0 -relwidth 0.05 -height 0 -relheight 0.03 -anchor nw
E 12


set Name $Parent.b65
#------------------------------------------
label $Name -bg black -fg yellow -text {Active sectors}
D 12
place $Name -x 500 -relx 0 -y 406 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 12
I 12
D 13
place $Name -x 300 -relx 0 -y 580 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 13
I 13
place $Name -x 300 -relx 0 -y 590 -rely 0 -width {} -relwidth {} -height 24 -relheight 0 -anchor nw
E 13
E 12


E 10
E 6
#tkwait window .top0.b15
if {[info procs main] == "main"} {main}


I 4
D 16
# restore db entry from template
D 6
set str1 [open /usr/local/clas/parms/last_db_template.txt r]
E 6
I 6
D 15
set str1 [open /usr/local/clas/parms/run_log/last_db_template.txt r]
E 6
set temp [read $str1]
close $str1
.top0.t21 mark set here 1.0
.top0.t21 insert here $temp
E 15
I 15
#set str1 [open /usr/local/clas/parms/run_log/last_db_template.txt r]
#set temp [read $str1]
#close $str1
#.top0.t21 mark set here 1.0
#.top0.t21 insert here $temp
E 15

E 16
I 12
load_old
E 12
I 5

E 5
E 4
Suspend





E 18




E 66

E 1
